<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="site-title">Quantum Quirks</title>
    <style>
        :root {
            /* Theme Colors (Quantum Quirks) */
            --bg-color-primary: #2A0A4A;   /* Deep Violet */
            --bg-color-secondary: #3F156B; /* Lighter Deep Violet */
            --text-color: #E0BBE4;         /* Pale Lavender */
            --footer-bg: #1F0738;          /* Even darker violet */
            --glass-bg: rgba(42, 10, 74, 0.6); /* Transparent deep violet */
            --glass-border: rgba(224, 187, 228, 0.3); /* Transparent Pale Lavender */
            --fact-text-shadow: 2px 2px 15px rgba(0,0,0,0.9);
            --title-color: #DAA520;        /* Goldenrod */
            --title-shadow: 4px 4px 25px rgba(0, 0, 0, 0.9);
            --button-primary: #8A2BE2;     /* Blue Violet */
            --button-hover: #6A0DAD;       /* Darker Blue Violet */
            --main-action-btn: #FF6347;    /* Tomato */
            --main-action-btn-hover: #E5533D; /* Darker Tomato */
            --reveal-overlay-color: rgba(0, 0, 0, 0.7); /* Dark overlay for hidden fact */
            --generic-title-color: #E0BBE4; /* Pale Lavender for generic title */
            --theme-indicator-color: #DAA520; /* Goldenrod for theme indicator */
            --favorite-btn-color: #DAA520; /* Goldenrod for favorite button */
            --favorite-btn-hover: #B8860B; /* Dark Goldenrod */
            --star-color: #FFD700; /* Gold for stars */
            --notification-bg: rgba(0, 0, 0, 0.8);
            --notification-text: #E0BBE4;
            --correct-answer-color: #3CB371; /* Medium Sea Green */
            --incorrect-answer-color: #FF6347; /* Tomato */
        }

        #fact-streak-display {
            margin-top: 20px;
            margin-bottom: 20px;
            padding: 15px 30px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.5s ease;
        }

        #fact-streak-display p {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-color);
            margin: 0;
            text-shadow: 1px 1px 5px rgba(0,0,0,0.7);
        }

        #current-streak {
            font-size: 2rem;
            color: var(--title-color);
            font-weight: 900;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.9);
            transition: color 0.5s ease, transform 0.3s ease-out;
        }

        #current-streak.animate-pulse {
            animation: pulse 0.5s ease-out;
        }

        #reset-streak-btn {
            background-color: #6c757d; /* Grey for reset */
            color: white;
            padding: 10px 20px;
            font-size: 1rem;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
        }

        #reset-streak-btn:hover {
            background-color: #5a6268;
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(0,0,0,0.4);
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        body {
            background: linear-gradient(135deg, var(--bg-color-primary) 0%, var(--bg-color-secondary) 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
            transition: background 1.5s ease-in-out, color 0.8s ease;
            overflow-x: hidden;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .container {
            max-width: 1000px;
            width: 100%;
            margin-bottom: 20px;
            padding: 50px;
            background-color: var(--glass-bg);
            border-radius: 25px;
            box-shadow: 0 15px 50px 0 rgba( 0, 0, 0, 0.5 );
            backdrop-filter: blur( 12px );
            -webkit-backdrop-filter: blur( 12px );
            border: 1px solid var(--glass-border);
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        h1#main-title {
            font-size: 4.5rem;
            margin-bottom: 1rem;
            text-shadow: var(--title-shadow);
            color: var(--title-color);
            letter-spacing: 3px;
            font-weight: 900;
            transition: color 1s ease;
        }
        #theme-indicator {
            font-size: 1.5rem;
            color: var(--theme-indicator-color);
            margin-bottom: 3rem;
            font-style: italic;
            opacity: 0.8;
            transition: color 1s ease;
        }

        #theme-selector-container {
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        #theme-selector-container label {
            font-size: 1.3rem;
            color: var(--text-color);
            font-weight: 600;
        }

        #theme-select {
            padding: 10px 20px;
            font-size: 1.1rem;
            border-radius: 10px;
            border: 1px solid var(--glass-border);
            background-color: var(--glass-bg);
            color: var(--text-color);
            cursor: pointer;
            appearance: none; /* Remove default dropdown arrow */
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23F5DEB3%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-6.5%200-12.3%203.2-16.1%208.1-3.8%204.9-4.9%2011.4-3.1%2017.4l130%20140c3.8%204.9%209.6%208.1%2016.1%208.1s12.3-3.2%2016.1-8.1l130-140c1.8-6-.1-12.5-3.9-17.4z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 1em;
            padding-right: 40px; /* Make space for the custom arrow */
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        #theme-select:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }

        #theme-select option {
            background-color: var(--bg-color-primary);
            color: var(--text-color);
        }

        p {
            font-size: 2.2rem;
            line-height: 1.6;
            margin-bottom: 2.5rem;
            cursor: default;
            transition: transform 0.3s ease-in-out, color 0.3s ease-in-out;
            text-shadow: var(--fact-text-shadow);
            font-weight: 600;
        }
        #main-fact-container {
            margin-top: 30px;
            margin-bottom: 30px;
            padding: 35px 45px;
            background-color: var(--glass-bg);
            border-radius: 25px;
            box-shadow: 0 10px 35px rgba(0,0,0,0.5);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            cursor: default;
            transition: all 0.5s ease, transform 0.3s ease-out;
            position: relative;
            overflow: hidden;
            max-width: 900px;
            width: 90%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 200px;
        }
        #main-fact-text {
            font-size: 2.8rem; /* Increased font size */
            color: var(--text-color);
            background-color: transparent;
            padding: 15px 25px;
            border-radius: 12px;
            font-style: italic;
            font-weight: 700;
            text-shadow: var(--fact-text-shadow);
            transition: color 1s ease, background-color 1s ease, filter 1s ease, opacity 1s ease, text-shadow 1s ease, transform 0.5s ease;
            line-height: 1.5;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
            z-index: 1;
            filter: blur(8px); /* Blurred initially */
            opacity: 0.3; /* Less opaque initially */
        }
        #main-fact-container.revealed #main-fact-text {
            filter: blur(0px); /* Not blurred when revealed */
            opacity: 1; /* Fully opaque when revealed */
            transform: scale(1.05); /* Slightly larger when revealed */
        }
        #main-fact-container.revealed #main-fact-text.animate-in {
            animation: fadeInScale 0.8s ease-out forwards;
        }
        #reveal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--reveal-overlay-color);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2;
            transition: opacity 0.5s ease-out;
        }
        #main-fact-container.revealed #reveal-overlay {
            opacity: 0;
            pointer-events: none; /* Allow clicks to pass through once hidden */
        }
        #reveal-fact-btn {
            padding: 20px 40px;
            font-size: 1.8rem;
            font-weight: bold;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            background-color: var(--main-action-btn);
            color: white;
            box-shadow: 0 8px 25px rgba(0,0,0,0.5);
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
            animation: pulse 2s infinite; /* Added pulse animation */
        }
        #reveal-fact-btn:hover {
            background-color: var(--main-action-btn-hover);
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 12px 30px rgba(0,0,0,0.6);
            animation: none; /* Stop pulse on hover */
        }
        #did-you-know {
            margin-top: 30px;
            padding-top: 25px;
            border-top: 1px solid rgba(255, 255, 255, 0.3);
            text-align: left;
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            transition: max-height 1s ease-out, opacity 1s ease-out, transform 1s ease-out;
            transform: translateY(20px);
            width: 90%;
            max-width: 850px;
            background-color: rgba(0,0,0,0.2); /* Subtle background for emphasis */
            border-radius: 10px;
            padding: 25px;
            box-sizing: border-box;
        }
        #did-you-know.visible {
            max-height: 200px; /* Adjusted for content */
            opacity: 1;
            transform: translateY(0);
        }
        #did-you-know h3 {
            color: var(--generic-title-color);
            font-size: 1.8rem;
            margin-bottom: 15px;
            text-shadow: 1px 1px 8px rgba(0,0,0,0.7);
        }
        #did-you-know p {
            font-size: 1.4rem;
            line-height: 1.4;
            color: var(--text-color);
            text-shadow: none;
            font-weight: 400;
        }
        .button-group {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .button-group.primary-actions {
            margin-top: 40px;
            margin-bottom: 20px;
        }
        .button-group.secondary-actions {
            margin-bottom: 20px;
        }
        .button-group.utility-actions {
            margin-bottom: 40px;
        }
        .action-button {
            padding: 15px 30px;
            font-size: 1.3rem;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .action-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }
        #toggle-did-you-know-btn {
            background-color: var(--main-action-btn);
            color: white;
        }
        #toggle-did-you-know-btn:hover {
            background-color: var(--main-action-btn-hover);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }
        #new-fact-btn {
            background-color: var(--button-primary);
            color: white;
        }
        #new-fact-btn:hover {
            background-color: var(--button-hover);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }
        #copy-fact-btn, #share-twitter-btn, #share-whatsapp-btn {
            background-color: #555; /* A neutral grey */
            color: white;
            padding: 10px 20px;
            font-size: 1rem;
            margin-top: 15px;
        }
        #copy-fact-btn:hover, #share-twitter-btn:hover, #share-whatsapp-btn:hover {
            background-color: #777;
            transform: translateY(-2px);
        }
        #favorite-fact-btn {
            background-color: var(--favorite-btn-color);
            color: black; /* Black text for gold button */
        }
        #favorite-fact-btn:hover {
            background-color: var(--favorite-btn-hover);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }
        #favorite-fact-btn.favorited {
            background-color: #FFEB3B; /* Lighter yellow when favorited */
            color: #B71C1C; /* Red text for contrast */
            box-shadow: 0 0 15px 5px rgba(255, 215, 0, 0.7);
        }

        #favorite-facts-display, #fact-history-display {
            margin-top: 40px;
            padding: 25px;
            background-color: rgba(0,0,0,0.3);
            border-radius: 15px;
            width: 90%;
            max-width: 850px;
            text-align: left;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.5);
            display: none; /* Hidden by default */
            flex-direction: column;
            gap: 15px;
        }
        #favorite-facts-display.visible, #fact-history-display.visible {
            display: flex;
        }
        #favorite-facts-display h3, #fact-history-display h3 {
            color: var(--generic-title-color);
            font-size: 1.8rem;
            margin-bottom: 15px;
            text-shadow: 1px 1px 8px rgba(0,0,0,0.7);
            text-align: center;
        }
        .favorite-fact-item, .history-fact-item {
            background-color: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1rem;
            line-height: 1.4;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .favorite-fact-item .remove-fav-btn, .history-fact-item .remove-history-btn {
            background-color: #DC3545; /* Red for remove */
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s ease;
        }
        .favorite-fact-item .remove-fav-btn:hover, .history-fact-item .remove-history-btn:hover {
            background-color: #C82333;
        }

        /* Fact Rating Feature Styles */
        #fact-rating-container {
            margin-top: 20px;
            display: none; /* Hidden initially */
            flex-direction: column;
            align-items: center;
            gap: 10px;
            opacity: 0;
            transition: opacity 0.5s ease-out;
        }
        #fact-rating-container.visible {
            display: flex;
            opacity: 1;
        }
        .star-rating {
            display: flex;
            gap: 5px;
        }
        .star-rating .star {
            font-size: 2.5rem;
            color: #555; /* Default grey for unselected stars */
            cursor: pointer;
            transition: color 0.2s ease, transform 0.2s ease;
        }
        .star-rating .star.selected {
            color: var(--star-color); /* Use theme color for selected stars */
            transform: scale(1.2);
        }
        footer {
            width: 100%;
            padding: 15px 0;
            background-color: var(--footer-bg); /* Use theme variable */
            color: var(--text-color); /* Ensure footer text color matches theme */
            font-size: 1rem;
            margin-top: auto; /* Pushes footer to the bottom */
            opacity: 0.9;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.3);
            transition: background-color 1s ease, color 1s ease;
        }
        footer p {
            color: var(--text-color); /* Ensure footer text color matches theme */
            font-size: 1rem;
            margin: 0;
            opacity: 0.7;
        }

        .quiz-option-btn {
            background-color: var(--button-primary);
            color: white;
            padding: 12px 25px;
            font-size: 1.1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .quiz-option-btn:hover {
            background-color: var(--button-hover);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .quiz-option-btn.selected {
            background-color: var(--main-action-btn);
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }

        .quiz-option-btn.correct {
            background-color: var(--correct-answer-color);
            color: white;
            font-weight: bold;
            animation: pulseCorrect 0.5s ease-out;
        }

        .quiz-option-btn.incorrect {
            background-color: var(--incorrect-answer-color);
            color: white;
            font-weight: bold;
            animation: shake 0.3s ease-out;
        }

        @keyframes pulseCorrect {
            0% { transform: scale(1); }
            50% { transform: scale(1.08); }
            100% { transform: scale(1); }
        }

        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }\n            100% { transform: translateX(0); }\n        }\n\n        /* Mastery Progress Bar Styling */\n        #fact-mastery-display {\n            margin-top: 20px;\n            margin-bottom: 20px;\n            padding: 15px 30px;\n            background-color: rgba(255, 255, 255, 0.1);\n            border-radius: 15px;\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            gap: 10px;\n            box-shadow: 0 5px 20px rgba(0,0,0,0.3);\n            border: 1px solid rgba(255, 255, 255, 0.2);\n            transition: all 0.5s ease;\n            color: var(--text-color);\n            font-size: 1.3rem;\n            font-weight: 600;\n            text-shadow: 1px 1px 5px rgba(0,0,0,0.7);\n        }\n\n        #mastery-progress-bar-container {\n            width: 80%;\n            background-color: rgba(0,0,0,0.3);\n            border-radius: 10px;\n            height: 15px;\n            overflow: hidden;\n            box-shadow: inset 0 2px 5px rgba(0,0,0,0.5);\n        }\n\n        #mastery-progress-bar {\n            height: 100%;\n            width: 0%; /* Initial width */\n            background-color: var(--title-color); /* Use a theme color for progress */\n            border-radius: 10px;\n            transition: width 0.5s ease-in-out;\n        }\n\n        #fact-quiz-container h3, #fact-challenge-container h3 {\n            color: var(--generic-title-color);\n            font-size: 2rem; /* Slightly larger */\n            margin-bottom: 20px;\n            text-shadow: 2px 2px 10px rgba(0,0,0,0.8); /* Stronger shadow */\n            transition: text-shadow 0.5s ease;\n        }\n\n        #fact-challenge-container {\n            margin-top: 30px;\n            padding: 25px;\n            background-color: var(--glass-bg);\n            border-radius: 15px;\n            box-shadow: 0 10px 35px rgba(0,0,0,0.5);\n            backdrop-filter: blur(12px);\n            -webkit-backdrop-filter: blur(12px);\n            border: 1px solid var(--glass-border);\n            width: 90%;\n            max-width: 850px;\n            display: none; /* Hidden by default */\n            flex-direction: column;\n            align-items: center;\n            gap: 15px;\n        }\n\n        #fact-challenge-container.visible {\n            display: flex;\n        }\n\n        #challenge-options .quiz-option-btn {\n            min-width: 180px;\n        }\n    </style>\n</head>\n<body>\n    <div class="container">\n        <h1 id="main-title">Quantum Quirks</h1>\n        <span id="theme-indicator">Theme: Quantum Quirks</span>\n\n        <div id="theme-selector-container">\n            <label for="theme-select">Explore Themes:</label>\n            <select id="theme-select" class="action-button">\n                <option value="random">Random Theme</option>\n                <option value="Cosmic Wonders">Cosmic Wonders</option>\n                <option value="Oceanic Depths">Oceanic Depths</option>\n                <option value="Ancient Earth">Ancient Earth</option>\n                <option value="Microscopic Marvels">Microscopic Marvels</option>\n                <option value="Quantum Quirks">Quantum Quirks</option>\n                <option value="Ancient Civilizations">Ancient Civilizations</option>\n            </select>\n        </div>\n\n        <div id="fact-streak-display">\n            <p>Discovery Streak: <span id="current-streak">0</span></p>\n            <button id="reset-streak-btn" class="action-button">Reset Streak</button>\n        </div>\n\n        <!-- New Feature: Fact Mastery Level -->\n        <div id="fact-mastery-display">\n            Mastery Level: <span id="fact-mastery-level">Novice Explorer</span>\n            <div id="mastery-progress-bar-container">\n                <div id="mastery-progress-bar"></div>\n            </div>\n        </div>\n\n        <div id="main-fact-container">\n            <p id="main-fact-text" data-full-text="Particles can be in two places at once, a phenomenon known as superposition."></p>\n            <div id="reveal-overlay">\n                <button id="reveal-fact-btn">Reveal Fact</button>\n            </div>\n            <div id="did-you-know">\n                <h3>Did You Know?</h3>\n                <p>This bizarre quantum property is famously illustrated by Schrödinger's Cat thought experiment, where a cat in a sealed box is simultaneously dead and alive until observed.</p>\n            </div>\n\n            <!-- New Feature: Fact Rating -->\n            <div id="fact-rating-container">\n                <p>Rate this fact:</p>\n                <div class="star-rating" id="star-rating">\n                    <span class="star" data-value="1">&#9733;</span>\n                    <span class="star" data-value="2">&#9733;</span>\n                    <span class="star" data-value="3">&#9733;</span>\n                    <span class="star" data-value="4">&#9733;</span>\n                    <span class="star" data-value="5">&#9733;</span>\n                </div>\n                <p id="rating-message"></p>\n            </div>\n\n            <div class="button-group primary-actions">\n                <button id="new-fact-btn" class="action-button" disabled>Discover Another Wonder</button>\n            </div>\n            <div id="fact-quiz-container">\n                <h3>Fact Quiz!</h3>\n                <p id="quiz-question"></p>\n                <div class="quiz-options" id="quiz-options">\n                    <!-- Quiz options will be loaded here -->\n                </div>\n                <button id="submit-quiz-btn" class="action-button" disabled>Submit Answer</button>\n                <p id="quiz-feedback"></p>\n            </div>\n            <!-- New Feature: Fact Challenge -->\n            <div id="fact-challenge-container">\n                <h3>Fact Challenge: Guess the Theme!</h3>\n                <p id="challenge-question">Which theme does this fact belong to?</p>\n                <div class="quiz-options" id="challenge-options">\n                    <!-- Challenge options will be loaded here -->\n                </div>\n                <button id="submit-challenge-btn" class="action-button" disabled>Submit Theme Guess</button>\n                <p id="challenge-feedback"></p>\n            </div>\n            <div class="button-group secondary-actions">\n                <button id="toggle-did-you-know-btn" class="action-button" disabled>Hide Details</button>\n                <button id="favorite-fact-btn" class="action-button" disabled>Favorite Fact</button>\n                <button id="copy-fact-btn" class="action-button" disabled>Copy Fact</button>\n                <button id="share-twitter-btn" class="action-button" disabled>Share on Twitter</button>\n                <button id="share-whatsapp-btn" class="action-button" disabled>Share on WhatsApp</button>\n            </div>\n            <div class="button-group utility-actions">\n                <button id="toggle-favorite-facts-btn" class="action-button">View Favorite Facts</button>\n                <button id="toggle-fact-history-btn" class="action-button">View Fact History</button>\n            </div>\n        </div>\n\n        <div id="favorite-facts-display">\n            <h3>Your Favorite Facts</h3>\n            <div id="favorite-facts-list">\n                <!-- Favorite facts will be loaded here -->\n            </div>\n        </div>\n\n        <div id="fact-history-display">\n            <h3>Fact History</h3>\n            <div id="fact-history-list">\n                <!-- Fact history will be loaded here -->\n            </div>\n        </div>\n    </div>\n\n    <!-- Notification Toast -->\n    <div id="notification-toast"></div>\n\n    <footer>\n        <p>Site will update again at: <span id="update-time">Loading...</span></p>\n    </footer>\n\n    <script>\n        const factText = document.getElementById('main-fact-text');\n        const toggleDidYouKnowBtn = document.getElementById('toggle-did-you-know-btn');\n        const newFactBtn = document.getElementById('new-fact-btn');\n        const didYouKnow = document.getElementById('did-you-know');\n        const siteTitle = document.getElementById('site-title');\n        const mainTitle = document.getElementById('main-title');\n        const updateTimeSpan = document.getElementById('update-time');\n        const mainFactContainer = document.getElementById('main-fact-container');\n        const themeIndicator = document.getElementById('theme-indicator');\n        const copyFactBtn = document.getElementById('copy-fact-btn');\n        const shareTwitterBtn = document.getElementById('share-twitter-btn');\n        const shareWhatsappBtn = document.getElementById('share-whatsapp-btn');\n        const revealFactBtn = document.getElementById('reveal-fact-btn');\n        const revealOverlay = document.getElementById('reveal-overlay');\n        const favoriteFactBtn = document.getElementById('favorite-fact-btn');\n        const favoriteFactsDisplay = document.getElementById('favorite-facts-display');\n        const favoriteFactsList = document.getElementById('favorite-facts-list');\n        const currentStreakSpan = document.getElementById('current-streak');\n        const resetStreakBtn = document.getElementById('reset-streak-btn');\n        const toggleFavoriteFactsBtn = document.getElementById('toggle-favorite-facts-btn');\n        const themeSelect = document.getElementById('theme-select');\n        const toggleFactHistoryBtn = document.getElementById('toggle-fact-history-btn');\n        const factHistoryDisplay = document.getElementById('fact-history-display');\n        const factHistoryList = document.getElementById('fact-history-list');\n        const factRatingContainer = document.getElementById('fact-rating-container');\n        const starRating = document.getElementById('star-rating');\n        const ratingMessage = document.getElementById('rating-message');\n        const factMasteryLevelSpan = document.getElementById('fact-mastery-level');\n        const masteryProgressBar = document.getElementById('mastery-progress-bar');\n        const notificationToast = document.getElementById('notification-toast');\n\n        // Quiz elements\n        const factQuizContainer = document.getElementById('fact-quiz-container');\n        const quizQuestion = document.getElementById('quiz-question');\n        const quizOptionsContainer = document.getElementById('quiz-options');\n        const submitQuizBtn = document.getElementById('submit-quiz-btn');\n        const quizFeedback = document.getElementById('quiz-feedback');\n\n        // Fact Challenge elements\n        const factChallengeContainer = document.getElementById('fact-challenge-container');\n        const challengeQuestion = document.getElementById('challenge-question');\n        const challengeOptionsContainer = document.getElementById('challenge-options');\n        const submitChallengeBtn = document.getElementById('submit-challenge-btn');\n        const challengeFeedback = document.getElementById('challenge-feedback');\n\n\n        // Function to update the time in the footer\n        function updateFooterTime() {\n            const now = new Date();\n            // Add 24 hours for the "upcoming update" time\n            now.setHours(now.getHours() + 24);\n            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: true };\n            updateTimeSpan.textContent = now.toLocaleString('en-US', options);\n        }\n\n        // Initial call to set the time\n        updateFooterTime();\n        // Update time every minute (optional, but good for "upcoming update" feel)\n        setInterval(updateFooterTime, 60000);\n\n        const facts = [\n            {\n                theme: "Cosmic Wonders",\n                fact: "There are more stars in the universe than grains of sand on all the beaches on Earth.",\n                didYouKnow: "The observable universe is estimated to contain about 100 billion to 200 billion galaxies, each with billions of stars!",\n                bgColor: "#0D0D2B", // Deep Space Blue\n                bgSecondaryColor: "#1A1A40",\n                textColor: "#E0FFFF", // Light Cyan\n                footerBg: "#08081A",\n                titleColor: "#FFD700", // Gold\n                buttonPrimary: "#4A00B0", // Deep Purple\n                mainActionBtn: "#FF4500", // OrangeRed\n                quiz: {\n                    question: "What is the estimated range of galaxies in the observable universe?",\n                    options: ["10-20 billion", "50-100 billion", "100-200 billion", "500-1000 billion"],\n                    answer: "100-200 billion"\n                }\n            },\n            {\n                theme: "Oceanic Depths",\n                fact: "The Mariana Trench is deeper than Mount Everest is tall.",\n                didYouKnow: "If Mount Everest were placed in the Mariana Trench, its peak would still be over a mile (1.6 km) underwater! The pressure at the bottom is over 1,000 times that at sea level.",\n                bgColor: "#001F3F", // Dark Midnight Blue\n                bgSecondaryColor: "#002B55",\n                textColor: "#7FDBFF", // Aqua\n                footerBg: "#001228",\n                titleColor: "#FFDC00", // Gold\n                buttonPrimary: "#0074D9", // Blue\n                mainActionBtn: "#FF851B", // Orange\n                quiz: {\n                    question: "How many times greater is the pressure at the bottom of the Mariana Trench compared to sea level?",\n                    options: ["100 times", "500 times", "1,000 times", "10,000 times"],\n                    answer: "1,000 times"\n                }\n            },\n            {\n                theme: "Ancient Earth",\n                fact: "Dinosaurs roamed the Earth for over 160 million years, a period far longer than humans have existed.",\n                didYouKnown: "The Tyrannosaurus Rex lived closer in time to humans than it did to the Stegosaurus! This highlights the immense span of the Mesozoic Era.",\n                bgColor: "#2E2E00", // Dark Olive Green\n                bgSecondaryColor: "#3A3A00",\n                textColor: "#E6E6B8", // Pale Yellow\n                footerBg: "#1A1A00",\n                titleColor: "#A0522D", // Sienna\n                buttonPrimary: "#8B4513", // SaddleBrown\n                mainActionBtn: "#D2691E", // Chocolate\n                quiz: {\n                    question: "For how many million years did dinosaurs roam the Earth?  ",\n                    options: ["50 million", "100 million", "160 million", "200 million"],\n                    answer: "160 million"\n                }\n            },\n            {\n                theme: "Microscopic Marvels",\n                fact: "A single human body contains more bacterial cells than human cells.",\n                didYouKnow: "These bacteria, collectively known as the microbiome, play crucial roles in digestion, immunity, and even mood! They are essential for our health.",\n                bgColor: "#1A331A", // Dark Forest Green\n                bgSecondaryColor: "#254725",\n                textColor: "#CCFFCC", // Pale Green\n                footerBg: "#1F0738",\n                titleColor: "#8FBC8F", // Dark Sea Green\n                buttonPrimary: "#3CB371", // Medium Sea Green\n                mainActionBtn: "#FFD700", // Gold\n                quiz: {\n                    question: "What is the collective name for the bacteria in a human body?",\n                    options: ["Microflora", "Microbiome", "Probiotics", "Pathogens"],\n                    answer: "Microbiome"\n                }\n            },\n            {\n                theme: "Quantum Quirks",\n                fact: "Particles can be in two places at once, a phenomenon known as superposition.",\n                didYouKnow: "This bizarre quantum property is famously illustrated by Schrödinger's Cat thought experiment, where a cat in a sealed box is simultaneously dead and alive until observed.",\n                bgColor: "#2A0A4A", // Deep Violet\n                bgSecondaryColor: "#3F156B",\n                textColor: "#E0BBE4", // Pale Lavender\n                footerBg: "#1F0738",\n                titleColor: "#DAA520", // Goldenrod\n                buttonPrimary: "#8A2BE2", // Blue Violet\n                mainActionBtn: "#FF6347", // Tomato\n                quiz: {\n                    question: "What is the phenomenon called when particles can be in two places at once?",\n                    options: ["Entanglement", "Superposition", "Quantum Tunneling", "Wave-particle duality"],\n                    answer: "Superposition"\n                }\n            },\n            {\n                theme: "Ancient Civilizations",\n                fact: "The Great Pyramid of Giza was the tallest man-made structure for over 3,800 years.",\n                didYouKnow: "Built around 2580–2560 BC, it held this record until the Lincoln Cathedral was completed in 1311 AD. Its precision engineering continues to baffle modern scientists.",\n                bgColor: "#4A3B2A", // Dark Brown\n                bgSecondaryColor: "#6B5A4A",\n                textColor: "#F5DEB3", // Wheat\n                footerBg: "#382C1F",\n                titleColor: "#D4AF37", // Gold (metallic)\n                buttonPrimary: "#A0522D", // Sienna\n                mainActionBtn: "#CD853F", // Peru\n                quiz: {\n                    question: "For how many years was the Great Pyramid of Giza the tallest man-made structure?",\n                    options: ["1,000 years", "2,500 years", "3,800 years", "5,000 years"],\n                    answer: "3,800 years"\n                }\n            }\n        ];\n\n        let currentFactIndex; // Will be set randomly on initial load\n        let factStreak = 0;\n        let favoriteFacts = JSON.parse(localStorage.getItem('favoriteFacts')) || [];\n        let factHistory = JSON.parse(localStorage.getItem('factHistory')) || [];\n        let selectedQuizOption = null;\n        let selectedChallengeOption = null;\n\n        // Mastery levels\n        const masteryLevels = [\n            { threshold: 0, level: "Novice Explorer", progress: 0 },\n            { threshold: 5, level: "Curious Mind", progress: 0 },\n            { threshold: 10, level: "Knowledge Seeker", progress: 0 },\n            { threshold: 20, level: "Master of Lore", progress: 0 }\n        ];\n\n        function updateMasteryLevel() {\n            let currentLevelIndex = 0;\n            for (let i = masteryLevels.length - 1; i >= 0; i--) {\n                if (factStreak >= masteryLevels[i].threshold) {\n                    currentLevelIndex = i;\n                    break;\n                }\n            }\n            const currentLevel = masteryLevels[currentLevelIndex];\n            let icon = '';\n            switch (currentLevel.level) {\n                case "Novice Explorer":\n                    icon = '&#128064;'; // Eye emoji\n                    break;\n                case "Curious Mind":\n                    icon = '&#128161;'; // Lightbulb emoji\n                    break;\n                case "Knowledge Seeker":\n                    icon = '&#128218;'; // Open book emoji\n                    break;\n                case "Master of Lore":\n                    icon = '&#127891;'; // Graduation cap emoji\n                    break;\n                default:\n                    icon = '';\n            }\n            factMasteryLevelSpan.innerHTML = `${icon} ${currentLevel.level}`;\n\n            // Calculate progress for the current level\n            let progress = 0;\n            if (currentLevelIndex < masteryLevels.length - 1) {\n                const nextLevel = masteryLevels[currentLevelIndex + 1];\n                const factsNeededForNext = nextLevel.threshold - currentLevel.threshold;\n                const factsDiscoveredInLevel = factStreak - currentLevel.threshold;\n                progress = (factsDiscoveredInLevel / factsNeededForNext) * 100;\n            } else {\n                progress = 100; // Max level reached\n            }\n            masteryProgressBar.style.width = `${progress}%`;\n        }\n\n        function showNotification(message, duration = 3000) {\n            notificationToast.textContent = message;\n            notificationToast.classList.add('show');\n            setTimeout(() => {\n                notificationToast.classList.remove('show');\n            }, duration);\n        }\n\n        function hexToRgb(hex) {\n            const bigint = parseInt(hex.slice(1), 16);\n            const r = (bigint >> 16) & 255;\n            const g = (bigint >> 8) & 255;\n            const b = bigint & 255;\n            return { r, g, b };\n        }\n\n        function darkenColor(hex, percent) {\n            let f = parseInt(hex.slice(1), 16),\n                t = percent < 0 ? 0 : 255,\n                p = percent < 0 ? percent * -1 : percent,\n                R = f >> 16,\n                G = (f >> 8) & 0x00ff,\n                B = f & 0x0000ff;\n            return "#" +\n                (\n                    0x1000000 +\n                    (Math.round((t - R) * p) + R) * 0x10000 +\n                    (Math.round((t - G) * p) + G) * 0x100 +\n                    (Math.round((t - B) * p) + B)\n                )\n                .toString(16)\n                .slice(1);\n        }\n\n        function applyTheme(theme) {\n            const root = document.documentElement;\n            root.style.setProperty('--bg-color-primary', theme.bgColor);\n            root.style.setProperty('--bg-color-secondary', theme.bgSecondaryColor);\n            root.style.setProperty('--text-color', theme.textColor);\n            root.style.setProperty('--footer-bg', theme.footerBg);\n            root.style.setProperty('--glass-bg', `rgba(${hexToRgb(theme.bgColor).r}, ${hexToRgb(theme.bgColor).g}, ${hexToRgb(theme.bgColor).b}, 0.6)`);\n            root.style.setProperty('--glass-border', `rgba(${hexToRgb(theme.textColor).r}, ${hexToRgb(theme.textColor).g}, ${hexToRgb(theme.textColor).b}, 0.3)`);\n            root.style.setProperty('--title-color', theme.titleColor);\n            root.style.setProperty('--theme-indicator-color', theme.titleColor);\n            root.style.setProperty('--button-primary', theme.buttonPrimary);\n            root.style.setProperty('--button-hover', darkenColor(theme.buttonPrimary, 20));\n            root.style.setProperty('--main-action-btn', theme.mainActionBtn);\n            root.style.setProperty('--main-action-btn-hover', darkenColor(theme.mainActionBtn, 20));\n            root.style.setProperty('--favorite-btn-color', theme.titleColor);\n            root.style.setProperty('--favorite-btn-hover', darkenColor(theme.titleColor, 20));\n            root.style.setProperty('--generic-title-color', theme.textColor);\n            root.style.setProperty('--notification-text', theme.textColor);\n\n            siteTitle.textContent = theme.theme;\n            mainTitle.textContent = theme.theme;\n            themeIndicator.textContent = `Theme: ${theme.theme}`;\n\n            // Update theme selector\n            themeSelect.value = theme.theme;\n        }\n\n        function loadFact(index) {\n            const factData = facts[index];\n            factText.dataset.fullText = factData.fact;\n            factText.textContent = ''; // Keep text content empty until revealed\n            didYouKnow.querySelector('p').textContent = factData.didYouKnow;\n            applyTheme(factData);\n\n            // Reset UI state for new fact\n            mainFactContainer.classList.remove('revealed');\n            factText.classList.remove('animate-in');\n            didYouKnow.classList.remove('visible');\n            revealOverlay.style.opacity = '1';\n            revealOverlay.style.pointerEvents = 'auto';\n            revealFactBtn.style.display = 'block';\n            newFactBtn.disabled = true; // This is good, keep it disabled\n            toggleDidYouKnowBtn.disabled = true;\n            favoriteFactBtn.disabled = true;\n            copyFactBtn.disabled = true;\n            shareTwitterBtn.disabled = true;\n            shareWhatsappBtn.disabled = true;\n            factQuizContainer.classList.remove('visible'); // Hide quiz\n            quizFeedback.textContent = ''; // Clear quiz feedback\n            quizOptionsContainer.innerHTML = ''; // Clear quiz options\n            submitQuizBtn.disabled = true; // Disable submit button\n            selectedQuizOption = null; // Reset selected option\n            favoriteFactBtn.classList.remove('favorited');\n            favoriteFactBtn.textContent = 'Favorite Fact'; // Reset button text\n            resetRating(); // Reset fact rating\n            factRatingContainer.classList.remove('visible'); // Hide rating until revealed\n            factChallengeContainer.classList.remove('visible'); // Hide challenge\n            challengeFeedback.textContent = '';\n            challengeOptionsContainer.innerHTML = '';\n            submitChallengeBtn.disabled = true;\n            selectedChallengeOption = null;\n        }\n\n        function revealFact() {\n            mainFactContainer.classList.add('revealed');\n            factText.textContent = factText.dataset.fullText; // Populate text content\n            factText.classList.add('animate-in');\n            revealOverlay.style.opacity = '0';\n            revealOverlay.style.pointerEvents = 'none';\n            revealFactBtn.style.display = 'none';\n            toggleDidYouKnowBtn.disabled = false;\n            didYouKnow.classList.add('visible'); // Automatically show Did You Know\n            toggleDidYouKnowBtn.textContent = 'Hide Details'; // Update button text\n            favoriteFactBtn.disabled = false;\n            copyFactBtn.disabled = false;\n            shareTwitterBtn.disabled = false;\n            shareWhatsappBtn.disabled = false;\n            factStreak++;\n            currentStreakSpan.textContent = factStreak;\n            currentStreakSpan.classList.add('animate-pulse');\n            setTimeout(() => currentStreakSpan.classList.remove('animate-pulse'), 500);\n            updateMasteryLevel(); // Update mastery level on streak increase\n            addToFactHistory(facts[currentFactIndex]); // Add to history when revealed\n            factRatingContainer.classList.add('visible'); // Show rating after reveal\n            startQuiz(); // Automatically start quiz after fact is revealed\n            startFactChallenge(); // Start fact challenge after quiz\n\n            // Check if current fact is favorited and update button\n            const currentFact = facts[currentFactIndex];\n            const isFavorited = favoriteFacts.some(f => f.fact === currentFact.fact);\n            if (isFavorited) {\n                favoriteFactBtn.classList.add('favorited');\n                favoriteFactBtn.textContent = 'Unfavorite Fact';\n            } else {\n                favoriteFactBtn.classList.remove('favorited');\n                favoriteFactBtn.textContent = 'Favorite Fact';\n            }\n        }\n\n        function toggleDidYouKnow() {\n            didYouKnow.classList.toggle('visible');\n            toggleDidYouKnowBtn.textContent = didYouKnow.classList.contains('visible') ? 'Hide Details' : 'Tell me more!';\n        }\n\n        function getNewFact() {\n            let newIndex;\n            do {\n                newIndex = Math.floor(Math.random() * facts.length);\n            } while (newIndex === currentFactIndex); // Ensure a different fact\n            currentFactIndex = newIndex;\n            loadFact(currentFactIndex);\n            factQuizContainer.classList.remove('visible'); // Hide quiz when new fact is loaded\n            quizFeedback.textContent = '';\n            quizOptionsContainer.innerHTML = '';\n            submitQuizBtn.disabled = true;\n            selectedQuizOption = null;\n            factChallengeContainer.classList.remove('visible'); // Hide challenge when new fact is loaded\n            challengeFeedback.textContent = '';\n            challengeOptionsContainer.innerHTML = '';\n            submitChallengeBtn.disabled = true;\n            selectedChallengeOption = null;\n        }\n\n        function copyFact() {\n            navigator.clipboard.writeText(factText.dataset.fullText).then(() => {\n                showNotification('Fact copied to clipboard!');\n            }).catch(err => {\n                console.error('Failed to copy fact: ', err);\n                showNotification('Failed to copy fact.', 4000);\n            });\n        }\n\n        function shareOnTwitter() {\n            const fact = factText.dataset.fullText;\n            const tweetUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(fact + " #DailyFact #GeminiCLI")}`;\n            window.open(tweetUrl, '_blank');\n            showNotification('Sharing fact on Twitter!', 3000);\n        }\n\n        function shareOnWhatsApp() {\n            const fact = factText.dataset.fullText;\n            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(fact + " #DailyFact #GeminiCLI")}`;\n            window.open(whatsappUrl, '_blank');\n            showNotification('Sharing fact on WhatsApp!', 3000);\n        }\n\n        function toggleFavoriteFact() {\n            const currentFact = facts[currentFactIndex];\n            const isFavorited = favoriteFacts.some(f => f.fact === currentFact.fact);\n\n            if (isFavorited) {\n                favoriteFacts = favoriteFacts.filter(f => f.fact !== currentFact.fact);\n                favoriteFactBtn.classList.remove('favorited');\n                favoriteFactBtn.textContent = 'Favorite Fact';\n                showNotification('Fact removed from favorites.', 2000);\n            } else {\n                favoriteFacts.push(currentFact);\n                favoriteFactBtn.classList.add('favorited');\n                favoriteFactBtn.textContent = 'Unfavorite Fact';\n                showNotification('Fact added to favorites!', 2000);\n            }\n            localStorage.setItem('favoriteFacts', JSON.stringify(favoriteFacts));\n            renderFavoriteFacts();\n        }\n\n        function renderFavoriteFacts() {\n            favoriteFactsList.innerHTML = '';\n            if (favoriteFacts.length === 0) {\n                favoriteFactsList.innerHTML = '<p>No favorite facts yet. Click the "Favorite Fact" button to add one!</p>';\n                return;\n            }\n            favoriteFacts.forEach((favFact, index) => {\n                const factItem = document.createElement('div');\n                factItem.classList.add('favorite-fact-item');\n                factItem.innerHTML = `\n                    <span>${favFact.fact}</span>\n                    <button class="remove-fav-btn" data-fact="${favFact.fact}">Remove</button>\n                `;\n                favoriteFactsList.appendChild(factItem);\n            });\n\n            document.querySelectorAll('.remove-fav-btn').forEach(button => {\n                button.addEventListener('click', (e) => {\n                    const factToRemove = e.target.dataset.fact;\n                    favoriteFacts = favoriteFacts.filter(f => f.fact !== factToRemove);\n                    localStorage.setItem('favoriteFacts', JSON.stringify(favoriteFacts));\n                    renderFavoriteFacts();\n                    // If the currently displayed fact was unfavorited, update its button state\n                    if (facts[currentFactIndex] && facts[currentFactIndex].fact === factToRemove) {\n                        favoriteFactBtn.classList.remove('favorited');\n                        favoriteFactBtn.textContent = 'Favorite Fact';\n                    }\n                    showNotification('Fact removed from favorites.', 2000);\n                });\n            });\n        }\n\n        function toggleFavoriteFactsDisplay() {\n            favoriteFactsDisplay.classList.toggle('visible');\n            if (favoriteFactsDisplay.classList.contains('visible')) {\n                renderFavoriteFacts();\n                factHistoryDisplay.classList.remove('visible'); // Hide history if favorites are shown\n            }\n        }\n\n        function addToFactHistory(factData) {\n            // Add only if it's a new fact or not the immediate repeat\n            if (factHistory.length === 0 || factHistory[factHistory.length - 1].fact !== factData.fact) {\n                factHistory.push(factData);\n                localStorage.setItem('factHistory', JSON.stringify(factHistory));\n                renderFactHistory();\n            }\n        }\n\n        function renderFactHistory() {\n            factHistoryList.innerHTML = '';\n            if (factHistory.length === 0) {\n                factHistoryList.innerHTML = '<p>No fact history yet. Discover some wonders!</p>';\n                return;\n            }\n            factHistory.slice().reverse().forEach((histFact, index) => { // Display newest first\n                const factItem = document.createElement('div');\n                factItem.classList.add('history-fact-item');\n                factItem.innerHTML = `\n                    <span>${histFact.fact}</span>\n                    <button class="remove-history-btn" data-fact="${histFact.fact}">Remove</button>\n                `;\n                factHistoryList.appendChild(factItem);\n            });\n\n            document.querySelectorAll('.remove-history-btn').forEach(button => {\n                button.addEventListener('click', (e) => {\n                    const factToRemove = e.target.dataset.fact;\n                    factHistory = factHistory.filter(f => f.fact !== factToRemove);\n                    localStorage.setItem('factHistory', JSON.stringify(factHistory));\n                    renderFactHistory();\n                    showNotification('Fact removed from history.', 2000);\n                });\n            });\n        }\n\n        function toggleFactHistoryDisplay() {\n            factHistoryDisplay.classList.toggle('visible');\n            if (factHistoryDisplay.classList.contains('visible')) {\n                renderFactHistory();\n                favoriteFactsDisplay.classList.remove('visible'); // Hide favorites if history is shown\n            }\n        }\n\n        function resetStreak() {\n            factStreak = 0;\n            currentStreakSpan.textContent = factStreak;\n            updateMasteryLevel(); // Update mastery level on streak reset\n            showNotification('Discovery streak reset!', 2000);\n        }\n\n        function handleThemeChange() {\n            const selectedThemeName = themeSelect.value;\n            if (selectedThemeName === 'random') {\n                getNewFact(); // This will also apply a random theme\n            } else {\n                const selectedTheme = facts.find(f => f.theme === selectedThemeName);\n                if (selectedTheme) {\n                    currentFactIndex = facts.indexOf(selectedTheme);\n                    loadFact(currentFactIndex);\n                }\n            }\n        }\n\n        // Fact Rating Logic\n        let currentRating = 0;\n\n        function resetRating() {\n            currentRating = 0;\n            ratingMessage.textContent = '';\n            document.querySelectorAll('.star').forEach(star => {\n                star.classList.remove('selected');\n            });\n        }\n\n        starRating.addEventListener('click', (e) => {\n            if (e.target.classList.contains('star')) {\n                const value = parseInt(e.target.dataset.value);\n                currentRating = value;\n                document.querySelectorAll('.star').forEach(star => {\n                    if (parseInt(star.dataset.value) <= value) {\n                        star.classList.add('selected');\n                    } else {\n                        star.classList.remove('selected');\n                    }\n                });\n                ratingMessage.textContent = `You rated this fact ${currentRating} out of 5 stars!`;\n                showNotification(`Fact rated ${currentRating} stars!`, 2000);\n            }\n        });\n\n        // Quiz Logic\n        function startQuiz() {\n            const currentFact = facts[currentFactIndex];\n            if (currentFact && currentFact.quiz) {\n                factQuizContainer.classList.add('visible');\n                quizQuestion.textContent = currentFact.quiz.question;\n                quizOptionsContainer.innerHTML = ''; // Clear previous options\n                selectedQuizOption = null;\n                submitQuizBtn.disabled = true;\n                quizFeedback.textContent = '';\n\n                currentFact.quiz.options.forEach(option => {\n                    const optionBtn = document.createElement('button');\n                    optionBtn.classList.add('quiz-option-btn');\n                    optionBtn.textContent = option;\n                    optionBtn.addEventListener('click', () => {\n                        // Deselect all other options\n                        document.querySelectorAll('#quiz-options .quiz-option-btn').forEach(btn => {\n                            btn.classList.remove('selected', 'correct', 'incorrect');\n                        });\n                        // Select current option\n                        optionBtn.classList.add('selected');\n                        selectedQuizOption = option;\n                        submitQuizBtn.disabled = false;\n                    });\n                    quizOptionsContainer.appendChild(optionBtn);\n                });\n            } else {\n                showNotification('No quiz available for this fact.', 3000);\n            }\n        }\n\n        function submitQuizAnswer() {\n            if (!selectedQuizOption) {\n                showNotification('Please select an answer!', 2000);\n                return;\n            }\n\n            const currentFact = facts[currentFactIndex];\n            const correctAnswer = currentFact.quiz.answer.trim();\n\n            document.querySelectorAll('#quiz-options .quiz-option-btn').forEach(btn => {\n                btn.disabled = true; // Disable all options after submission\n                if (btn.textContent.trim() === correctAnswer) {\n                    btn.classList.add('correct');\n                } else if (btn.classList.contains('selected')) {\n                    btn.classList.add('incorrect');\n                }\n            });\n\n            if (selectedQuizOption.trim() === correctAnswer) {\n                quizFeedback.textContent = 'Correct! Well done!';\n                quizFeedback.style.color = 'var(--correct-answer-color)';\n                showNotification('Quiz Answer: Correct!', 2000);\n            } else {\n                quizFeedback.textContent = `Incorrect. The correct answer was: ${correctAnswer}`;\n                quizFeedback.style.color = 'var(--incorrect-answer-color)';\n                showNotification('Quiz Answer: Incorrect.', 2000);\n            }\n            submitQuizBtn.disabled = true; // Disable submit after answering\n            // newFactBtn.disabled = false; // Enable "Discover Another Wonder" after quiz submission - moved to challenge\n        }\n\n        // Fact Challenge Logic\n        function startFactChallenge() {\n            const currentFact = facts[currentFactIndex];\n            factChallengeContainer.classList.add('visible');\n            challengeOptionsContainer.innerHTML = '';\n            selectedChallengeOption = null;\n            submitChallengeBtn.disabled = true;\n            challengeFeedback.textContent = '';\n\n            const correctTheme = currentFact.theme;\n            let themeOptions = [correctTheme];\n\n            // Get 2-3 other random themes\n            const otherThemes = facts.filter(f => f.theme !== correctTheme).map(f => f.theme);\n            while (themeOptions.length < 4 && otherThemes.length > 0) {\n                const randomIndex = Math.floor(Math.random() * otherThemes.length);\n                themeOptions.push(otherThemes.splice(randomIndex, 1)[0]);\n            }\n\n            // Shuffle options\n            themeOptions.sort(() => Math.random() - 0.5);\n\n            themeOptions.forEach(option => {\n                const optionBtn = document.createElement('button');\n                optionBtn.classList.add('quiz-option-btn');\n                optionBtn.textContent = option;\n                optionBtn.addEventListener('click', () => {\n                    document.querySelectorAll('#challenge-options .quiz-option-btn').forEach(btn => {\n                        btn.classList.remove('selected', 'correct', 'incorrect');\n                    });\n                    optionBtn.classList.add('selected');\n                    selectedChallengeOption = option;\n                    submitChallengeBtn.disabled = false;\n                });\n                challengeOptionsContainer.appendChild(optionBtn);\n            });\n        }\n\n        function submitFactChallengeAnswer() {\n            if (!selectedChallengeOption) {\n                showNotification('Please select a theme!', 2000);\n                return;\n            }\n\n            const currentFact = facts[currentFactIndex];\n            const correctTheme = currentFact.theme;\n\n            document.querySelectorAll('#challenge-options .quiz-option-btn').forEach(btn => {\n                btn.disabled = true; // Disable all options after submission\n                if (btn.textContent.trim() === correctTheme) {\n                    btn.classList.add('correct');\n                } else if (btn.classList.contains('selected')) {\n                    btn.classList.add('incorrect');\n                }\n            });\n\n            if (selectedChallengeOption.trim() === correctTheme) {\n                challengeFeedback.textContent = 'Correct! You guessed the theme!';\n                challengeFeedback.style.color = 'var(--correct-answer-color)';\n                showNotification('Challenge: Correct!', 2000);\n            } else {\n                challengeFeedback.textContent = `Incorrect. The correct theme was: ${correctTheme}`;\n                challengeFeedback.style.color = 'var(--incorrect-answer-color)';\n                showNotification('Challenge: Incorrect.', 2000);\n            }\n            submitChallengeBtn.disabled = true; // Disable submit after answering\n            newFactBtn.disabled = false; // Enable "Discover Another Wonder" after challenge submission\n        }\n\n\n        // Event Listeners\n        revealFactBtn.addEventListener('click', revealFact);\n        toggleDidYouKnowBtn.addEventListener('click', toggleDidYouKnow);\n        newFactBtn.addEventListener('click', getNewFact);\n        copyFactBtn.addEventListener('click', copyFact);\n        shareTwitterBtn.addEventListener('click', shareOnTwitter);\n        shareWhatsappBtn.addEventListener('click', shareOnWhatsApp);\n        favoriteFactBtn.addEventListener('click', toggleFavoriteFact);\n        resetStreakBtn.addEventListener('click', resetStreak);\n        toggleFavoriteFactsBtn.addEventListener('click', toggleFavoriteFactsDisplay);\n        themeSelect.addEventListener('change', handleThemeChange);\n        toggleFactHistoryBtn.addEventListener('click', toggleFactHistoryDisplay);\n        submitQuizBtn.addEventListener('click', submitQuizAnswer); // New quiz event listener\n        submitChallengeBtn.addEventListener('click', submitFactChallengeAnswer); // New challenge event listener\n\n        // Initial load: Pick a random fact and theme\n        currentFactIndex = Math.floor(Math.random() * facts.length);\n        loadFact(currentFactIndex);\n        renderFavoriteFacts();\n        renderFactHistory();\n        updateMasteryLevel(); // Set initial mastery level\n    </script>\n</body>\n</html>