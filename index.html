<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmic Facts Explorer</title>
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, hsl(240, 30%, 15%) 0%, hsl(260, 25%, 10%) 100%); /* Space theme gradient */
            --text-color: hsl(60, 80%, 90%); /* Light yellow/cream for contrast */
            --footer-bg: hsl(240, 20%, 10%);
            --button-primary: hsl(210, 45%, 55%);
            --button-hover: hsl(210, 55%, 65%);
            --main-action-btn: hsl(160, 65%, 45%);
            --main-action-btn-hover: hsl(160, 75%, 55%);
            --glass-bg: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.25);
            --fact-card-bg: rgba(0, 0, 0, 0.3);
            --fact-card-shadow-inset: inset 0 0 15px rgba(0,0,0,0.3);
            --fact-text-shadow: 1px 1px 5px rgba(0,0,0,0.3);
            --title-color: hsl(0, 0%, 100%);
            --title-shadow: 3px 3px 10px rgba(0, 0, 0, 0.5);
            --quiz-option-btn: hsl(200, 35%, 35%);
            --quiz-option-btn-hover: hsl(200, 45%, 45%);
            --quiz-correct: hsl(120, 55%, 45%);
            --quiz-incorrect: hsl(0, 55%, 45%);
            --challenge-timer-progress: hsl(0, 100%, 70%);
            --challenge-streak-color: hsl(160, 80%, 70%);
            --history-toggle-color: hsl(0, 0%, 95%);
            --history-list-color: hsl(0, 0%, 85%);
        }

        body {
            background: var(--bg-gradient);
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
            transition: background 0.8s ease-in-out, color 0.5s ease;
            overflow-x: hidden;
        }
        .container {
            max-width: 950px;
            width: 100%;
            margin-bottom: 20px;
            padding: 40px;
            background-color: var(--glass-bg);
            border-radius: 20px;
            box-shadow: 0 10px 40px 0 rgba( 31, 38, 135, 0.45 );
            backdrop-filter: blur( 8px );
            -webkit-backdrop-filter: blur( 8px );
            border: 1px solid var(--glass-border);
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        .container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at center, rgba(255,255,255,0.05) 10%, transparent 70%);
            animation: rotateBackground 20s linear infinite;
            opacity: 0.3;
        }
        @keyframes rotateBackground {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        h1#main-title {
            font-size: 4.5rem;
            margin-bottom: 1.8rem;
            text-shadow: var(--title-shadow);
            color: var(--title-color);
            letter-spacing: 2px;
            font-weight: 700;
        }
        .fact-card {
            background-color: var(--fact-card-bg);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 25px;
            width: 95%;
            max-width: 750px;
            box-shadow: 0 0 25px rgba(0,0,0,0.5), var(--fact-card-shadow-inset); /* Added outer shadow */
            position: relative;
            overflow: hidden;
            min-height: 250px; /* Ensure enough space for content */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        p {
            font-size: 2rem;
            line-height: 1.7;
            margin-bottom: 1.8rem;
            cursor: pointer;
            transition: transform 0.3s ease-in-out, color 0.3s ease-in-out;
            text-shadow: var(--fact-text-shadow);
        }
        p:hover {
            transform: scale(1.03);
            color: hsl(60, 100%, 85%);
        }
        #main-fact, #quiz-fact, #challenge-fact {
            animation: fadeInScale 1.2s ease-out forwards;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }
        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        @keyframes slideInFromBottom {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 0.95; }
        }
        #more-info {
            font-size: 1.4rem;
            color: hsl(0, 0%, 88%);
            margin-top: 20px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.8s ease-out, opacity 0.8s ease-out, transform 0.8s ease-out;
            opacity: 0;
            transform: translateY(-15px);
            border-top: 1px solid rgba(255, 255, 255, 0.15);
            padding-top: 20px;
        }
        #more-info.show-more-info {
            max-height: 250px;
            opacity: 1;
            transform: translateY(0);
        }
        .fact-actions, .social-actions, .challenge-actions {
            margin-top: 25px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px;
        }
        button {
            background-color: var(--button-primary);
            color: #FFFFFF;
            border: none;
            padding: 14px 28px;
            font-size: 1.2rem;
            cursor: pointer;
            border-radius: 10px;
            transition: background-color 0.3s, transform 0.2s, box-shadow 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.25);
            font-weight: 500;
        }
        button:hover {
            background-color: var(--button-hover);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.35);
        }
        button:active {
            transform: translateY(0);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
        }
        .main-action-btn {
            background-color: var(--main-action-btn);
            font-size: 1.4rem;
            padding: 18px 35px;
            margin-top: 35px;
            margin-bottom: 25px;
            border-radius: 12px;
        }
        .main-action-btn:hover {
            background-color: var(--main-action-btn-hover);
        }
        #footer-info {
            font-size: 1.3rem;
            color: var(--text-color);
            background-color: var(--footer-bg);
            padding: 18px 35px;
            border-radius: 12px;
            opacity: 0.98;
            margin-top: 35px;
            animation: slideInFromBottom 0.8s ease-out forwards;
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.3);
            font-weight: 500;
        }
        #fact-of-the-day {
            font-size: 1.2rem;
            color: hsl(60, 70%, 85%);
            margin-top: 20px;
            margin-bottom: 20px;
            font-style: italic;
        }

        /* Quiz Specific Styles */
        #quiz-area h2, #challenge-area h2 {
            font-size: 3rem;
            margin-bottom: 1.8rem;
            color: hsl(60, 100%, 90%);
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.4);
        }
        #quiz-fact, #challenge-fact {
            font-size: 1.8rem;
            margin-bottom: 2.5rem;
            min-height: 90px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #quiz-options, #challenge-options {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 18px;
            margin-bottom: 25px;
        }
        .quiz-option-btn, .challenge-option-btn {
            background-color: var(--quiz-option-btn);
            color: #FFFFFF;
            padding: 15px 30px;
            font-size: 1.2rem;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            min-width: 140px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .quiz-option-btn:hover, .challenge-option-btn:hover {
            background-color: var(--quiz-option-btn-hover);
            transform: translateY(-3px);
        }
        .quiz-option-btn.correct, .challenge-option-btn.correct {
            background-color: var(--quiz-correct);
            box-shadow: 0 0 15px hsl(120, 70%, 60%);
        }
        .quiz-option-btn.incorrect, .challenge-option-btn.incorrect {
            background-color: var(--quiz-incorrect);
            box-shadow: 0 0 15px hsl(0, 70%, 60%);
        }
        #quiz-feedback, #challenge-feedback {
            font-size: 1.8rem;
            font-weight: bold;
            min-height: 40px;
            margin-top: 15px;
            text-shadow: var(--fact-text-shadow);
        }

        /* Challenge Specific Styles */
        #challenge-timer-container {
            width: 80%;
            max-width: 400px;
            background-color: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
            position: relative;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #challenge-timer-progress {
            height: 100%;
            width: 100%;
            background-color: var(--challenge-timer-progress);
            border-radius: 15px;
            transition: width linear;
            position: absolute;
            left: 0;
            top: 0;
            transform-origin: left;
        }
        #challenge-timer-text {
            position: relative;
            z-index: 1;
            font-size: 1.8rem;
            font-weight: bold;
            color: #FFFFFF;
            text-shadow: 1px 1px 5px rgba(0,0,0,0.5);
        }
        #challenge-streak {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--challenge-streak-color);
            margin-top: 15px;
            min-height: 30px;
        }

        /* Collapsible History */
        .collapsible-section {
            margin-top: 35px;
            width: 95%;
            max-width: 750px;
            background-color: var(--glass-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            transition: max-height 0.8s ease-out;
            max-height: 90px;
        }
        .collapsible-section.expanded {
            max-height: 450px;
        }
        #history-toggle {
            cursor: pointer;
            font-size: 1.6rem;
            color: var(--history-toggle-color);
            margin-bottom: 18px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 600;
            text-shadow: var(--fact-text-shadow);
        }
        #history-toggle .toggle-icon {
            margin-left: 12px;
            transition: transform 0.3s ease;
            font-size: 1.2em;
        }
        .collapsible-section.expanded #history-toggle .toggle-icon {
            transform: rotate(180deg);
        }
        #history-list {
            list-style: none;
            padding: 0;
            margin: 0;
            text-align: left;
            color: var(--history-list-color);
            font-size: 1.15rem;
        }
        #history-list li {
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1));
        }
        #history-list li:last-child {
            border-bottom: none;
        }

        /* Fact Carousel / Navigation */
        .fact-navigation {
            position: absolute;
            top: 50%;
            width: 100%;
            display: flex;
            justify-content: space-between;
            transform: translateY(-50%);
            padding: 0 15px;
            box-sizing: border-box;
            pointer-events: none; /* Allow clicks to pass through to fact */
        }
        .nav-button {
            background-color: rgba(255, 255, 255, 0.15);
            border: none;
            color: white;
            font-size: 2.5rem;
            padding: 10px 15px;
            border-radius: 50%;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            pointer-events: all; /* Re-enable clicks for buttons */
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        .nav-button:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px) scale(1.05);
        }
        .nav-button:active {
            transform: translateY(0) scale(1);
        }

        /* Like Button Animation */
        .like-button.liked {
            animation: pulse 0.5s ease-out;
            background-color: hsl(0, 70%, 50%); /* Red for liked */
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 id="main-title">Cosmic Facts Explorer</h1>
        <div id="fact-of-the-day"></div>
        <div id="fact-display-area" class="fact-card">
            <p id="main-fact"></p>
            <p id="more-info"></p>
            <div class="fact-actions">
                <button id="new-fact-btn">New Fact</button>
                <button id="toggle-more-info-btn">Show More Info</button>
                <button id="read-aloud-btn">Read Aloud</button>
            </div>
            <div class="social-actions">
                <button id="copy-fact-btn">Copy</button>
                <button id="share-twitter-btn">Share</button>
                <button id="fact-source-btn">Source</button>
                <button id="like-fact-btn" class="like-button">Like</button>
            </div>
            <div class="fact-navigation">
                <button id="prev-fact-btn" class="nav-button">‹</button>
                <button id="next-fact-btn" class="nav-button">›</button>
            </div>
        </div>

        <div id="quiz-area" class="fact-card" style="display: none;">
            <h2>Fact Quiz!</h2>
            <p id="quiz-fact"></p>
            <div id="quiz-options"></div>
            <p id="quiz-feedback"></p>
            <button id="next-quiz-btn" style="display: none;">Next Question</button>
        </div>

        <div id="challenge-area" class="fact-card" style="display: none;">
            <h2>Fact Challenge!</h2>
            <p id="challenge-fact"></p>
            <div id="challenge-timer-container">
                <div id="challenge-timer-progress"></div>
                <span id="challenge-timer-text">Time: 10s</span>
            </div>
            <div id="challenge-options"></div>
            <p id="challenge-feedback"></p>
            <p id="challenge-streak">Streak: 0</p>
            <div class="challenge-actions">
                <button id="next-challenge-btn" style="display: none;">Next Challenge</button>
                <button id="restart-challenge-btn" style="display: none;">Restart Challenge</button>
            </div>
        </div>

        <div class="fact-actions">
            <button id="toggle-quiz-btn" class="main-action-btn">Start Fact Quiz</button>
            <button id="toggle-challenge-btn" class="main-action-btn">Start Fact Challenge</button>
        </div>
    </div>
    
    <div id="footer-info"></div>

    <div id="fact-history" class="collapsible-section">
        <h3 id="history-toggle">Fact History <span class="toggle-icon">▼</span></h3>
        <ul id="history-list"></ul>
    </div>
    
    <script>
        const facts = [
            { main: "🌳 Trees can communicate with each other, and forests can even create their own rain through a process called the Biotic Pump Theory.", more: "This communication happens through a network of fungi in their roots, and the Biotic Pump Theory suggests that forests can influence atmospheric pressure and humidity to generate rainfall.", theme: "Nature" },
            { main: "In the vacuum of space, two pieces of the same metal will permanently bond if they touch.", more: "This phenomenon is known as 'cold welding' and occurs because there's no atmosphere to create an oxide layer, allowing the atoms to fuse.", theme: "Space" },
            { main: "🦥 Sloths can hold their breath longer than dolphins.", more: "Sloths can slow their heart rate and hold their breath underwater for up to 40 minutes, which is longer than dolphins can.", theme: "Animals" },
            { main: "🌌 The Universe's average color is called 'Cosmic Latte'.", more: "This color was determined by a team of astronomers in 2002, averaging the light from over 200,000 galaxies.", theme: "Space" },
            { main: "🌌 A day on Venus is longer than its year.", more: "It takes about 243 Earth days to complete one spin on its axis, but only 225 Earth days to orbit the Sun.", theme: "Space" },
            { main: "🥛 Hippopotamus milk is pink.", more: "This unique color is due to two distinct acids, hipposudoric acid and norhipposudoric acid, which act as natural pigments and also have antibiotic properties.", theme: "Animals" },
            { main: "🌊 The Great Barrier Reef is the largest living structure on Earth and can be seen from space.", more: "It is composed of over 3,000 individual reefs and 900 islands stretching for over 2,300 kilometers.", theme: "Ocean" },
            { main: "🌳 A single oak tree can produce 10 million acorns in its lifetime.", more: "However, only about 1 in 10,000 acorns will grow into a new oak tree.", theme: "Nature" },
            { main: "🦋 The Monarch butterfly migrates up to 3,000 miles from Canada and the U.S. to Mexico.", more: "This incredible journey is undertaken by several generations of butterflies, with no single butterfly completing the entire round trip.", theme: "Animals" },
            { main: "🧠 The human brain weighs about 3 pounds but uses 20% of the body's oxygen and calories.", more: "It contains approximately 86 billion neurons, more than the number of stars in our galaxy.", theme: "Human Body" },
            { main: "💡 The average person will spend 6 months of their life waiting for red lights to turn green.", more: "This is based on an average commute and daily activities involving traffic lights.", theme: "Everyday Life" },
            { main: "🌳 There are more trees on Earth than stars in the Milky Way galaxy.", more: "Scientists estimate there are about 3 trillion trees on Earth, while the Milky Way is estimated to contain 100-400 billion stars.", theme: "Nature" },
            { main: "🌌 The Milky Way galaxy is thought to smell of rum, raspberries, and booze.", more: "This unique scent is attributed to ethyl formate, a chemical found in rum and raspberries, detected in the Sagittarius B2 cloud near the galaxy's center.", theme: "Space" }
        ];

        let currentFactIndex;
        let quizScore = 0;
        let currentQuizFact = null;
        let challengeScore = 0;
        let challengeTimer;
        let timeLeft = 10;
        let currentChallengeFact = null;
        let challengeStreak = 0;
        let factCarouselInterval;

        const mainTitleElement = document.getElementById('main-title');
        const factDisplayArea = document.getElementById('fact-display-area');
        const mainFactElement = document.getElementById('main-fact');
        const moreInfoElement = document.getElementById('more-info');
        const copyFactBtn = document.getElementById('copy-fact-btn');
        const shareTwitterBtn = document.getElementById('share-twitter-btn');
        const newFactBtn = document.getElementById('new-fact-btn');
        const toggleMoreInfoBtn = document.getElementById('toggle-more-info-btn');
        const factSourceBtn = document.getElementById('fact-source-btn');
        const readAloudBtn = document.getElementById('read-aloud-btn');
        const likeFactBtn = document.getElementById('like-fact-btn');
        const bodyElement = document.body;
        const footerInfoElement = document.getElementById('footer-info');
        const factOfTheDayElement = document.getElementById('fact-of-the-day');

        const quizArea = document.getElementById('quiz-area');
        const quizFactElement = document.getElementById('quiz-fact');
        const quizOptionsElement = document.getElementById('quiz-options');
        const quizFeedbackElement = document.getElementById('quiz-feedback');
        const nextQuizBtn = document.getElementById('next-quiz-btn');
        const toggleQuizBtn = document.getElementById('toggle-quiz-btn');

        const challengeArea = document.getElementById('challenge-area');
        const challengeFactElement = document.getElementById('challenge-fact');
        const challengeTimerContainer = document.getElementById('challenge-timer-container');
        const challengeTimerProgress = document.getElementById('challenge-timer-progress');
        const challengeTimerText = document.getElementById('challenge-timer-text');
        const challengeOptionsElement = document.getElementById('challenge-options');
        const challengeFeedbackElement = document.getElementById('challenge-feedback');
        const nextChallengeBtn = document.getElementById('next-challenge-btn');
        const restartChallengeBtn = document.getElementById('restart-challenge-btn');
        const toggleChallengeBtn = document.getElementById('toggle-challenge-btn');
        const challengeStreakElement = document.getElementById('challenge-streak');

        const factHistorySection = document.getElementById('fact-history');
        const historyToggle = document.getElementById('history-toggle');
        const historyListElement = document.getElementById('history-list');

        const prevFactBtn = document.getElementById('prev-fact-btn');
        const nextFactBtn = document.getElementById('next-fact-btn');

        const today = new Date();
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        // factOfTheDayElement.textContent = `Fact of the Day: ${facts[currentFactIndex].main}`; // This will be set after initial displayFact call

        const themeColors = {
            "Space": {
                background: 'linear-gradient(135deg, hsl(240, 30%, 15%) 0%, hsl(260, 25%, 10%) 100%)',
                text: 'hsl(60, 80%, 90%)',
                footerBackground: 'hsl(240, 20%, 10%)'
            },
            "Nature": {
                background: 'linear-gradient(135deg, hsl(120, 30%, 20%) 0%, hsl(100, 25%, 15%) 100%)',
                text: 'hsl(60, 80%, 90%)',
                footerBackground: 'hsl(120, 20%, 15%)'
            },
            "Animals": {
                background: 'linear-gradient(135deg, hsl(30, 40%, 25%) 0%, hsl(40, 30%, 20%) 100%)',
                text: 'hsl(0, 0%, 95%)',
                footerBackground: 'hsl(30, 30%, 20%)'
            },
            "Ocean": {
                background: 'linear-gradient(135deg, hsl(200, 50%, 20%) 0%, hsl(220, 45%, 15%) 100%)',
                text: 'hsl(180, 70%, 90%)',
                footerBackground: 'hsl(200, 40%, 15%)'
            },
            "Human Body": {
                background: 'linear-gradient(135deg, hsl(210, 10%, 25%) 0%, hsl(230, 15%, 20%) 100%)',
                text: 'hsl(0, 0%, 95%)',
                footerBackground: 'hsl(210, 10%, 15%)'
            },
            "Everyday Life": {
                background: 'linear-gradient(135deg, hsl(40, 20%, 30%) 0%, hsl(50, 15%, 25%) 100%)',
                text: 'hsl(0, 0%, 95%)',
                footerBackground: 'hsl(40, 15%, 25%)'
            }
        };

        function applyThemeColors(theme) {
            if (themeColors[theme]) {
                document.documentElement.style.setProperty('--bg-gradient', themeColors[theme].background);
                document.documentElement.style.setProperty('--text-color', themeColors[theme].text);
                document.documentElement.style.setProperty('--footer-bg', themeColors[theme].footerBackground);
            }
        }

        function displayFact(index) {
            mainFactElement.style.animation = 'none';
            void mainFactElement.offsetWidth; // Trigger reflow
            mainFactElement.style.animation = 'fadeInScale 1.2s ease-out forwards';

            mainFactElement.textContent = facts[index].main;
            moreInfoElement.textContent = facts[index].more;
            moreInfoElement.classList.remove('show-more-info');
            toggleMoreInfoBtn.textContent = 'Show More Info';
            likeFactBtn.classList.remove('liked'); // Reset like button state

            footerInfoElement.textContent = `Explore the amazing world of ${facts[index].theme}!`;
            applyThemeColors(facts[index].theme);
            updateFactHistory(facts[index].main);
            factOfTheDayElement.textContent = `Fact of the Day: ${facts[index].main}`; // Update fact of the day
        }

        function startFactCarousel() {
            clearInterval(factCarouselInterval); // Clear any existing interval
            factCarouselInterval = setInterval(() => {
                currentFactIndex = (currentFactIndex + 1) % facts.length;
                displayFact(currentFactIndex);
            }, 10000); // Change fact every 10 seconds
        }

        // Fact Display Event Listeners
        mainFactElement.addEventListener('click', () => {
            moreInfoElement.classList.toggle('show-more-info');
            toggleMoreInfoBtn.textContent = moreInfoElement.classList.contains('show-more-info') ? 'Hide More Info' : 'Show More Info';
        });

        newFactBtn.addEventListener('click', () => {
            currentFactIndex = Math.floor(Math.random() * facts.length);
            displayFact(currentFactIndex);
            startFactCarousel(); // Restart carousel on manual new fact
        });

        copyFactBtn.addEventListener('click', () => {
            navigator.clipboard.writeText(mainFactElement.textContent).then(() => {
                alert('Fact copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy fact: ', err);
            });
        });

        shareTwitterBtn.addEventListener('click', () => {
            const text = encodeURIComponent(mainFactElement.textContent + " #InterestingFacts #FactOfTheDay");
            window.open(`https://twitter.com/intent/tweet?text=${text}`, '_blank');
        });

        toggleMoreInfoBtn.addEventListener('click', () => {
            moreInfoElement.classList.toggle('show-more-info');
            toggleMoreInfoBtn.textContent = moreInfoElement.classList.contains('show-more-info') ? 'Hide More Info' : 'Show More Info';
        });

        factSourceBtn.addEventListener('click', () => {
            const factQuery = encodeURIComponent(mainFactElement.textContent.replace(/^[^\\s]+\\s/, ''));
            window.open(`https://www.google.com/search?q=${factQuery}`, '_blank');
        });

        readAloudBtn.addEventListener('click', () => {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(mainFactElement.textContent + ". " + moreInfoElement.textContent);
                speechSynthesis.speak(utterance);
            } else {
                alert("Sorry, your browser doesn't support text to speech.");
            }
        });

        likeFactBtn.addEventListener('click', () => {
            likeFactBtn.classList.add('liked');
            setTimeout(() => {
                likeFactBtn.classList.remove('liked');
            }, 500);
        });

        // Fact History Logic
        const factHistory = [];

        function updateFactHistory(fact) {
            if (factHistory.length === 0 || factHistory[factHistory.length - 1] !== fact) {
                factHistory.push(fact);
                if (factHistory.length > 5) {
                    factHistory.shift();
                }
            }
            renderFactHistory();
        }

        function renderFactHistory() {
            historyListElement.innerHTML = '';
            factHistory.forEach((fact, index) => {
                const listItem = document.createElement('li');
                listItem.textContent = `${index + 1}. ${fact}`;
                historyListElement.appendChild(listItem);
            });
        }

        historyToggle.addEventListener('click', () => {
            factHistorySection.classList.toggle('expanded');
        });

        // Quiz Logic
        const availableThemes = Object.keys(themeColors);

        toggleQuizBtn.addEventListener('click', () => {
            if (factDisplayArea.style.display !== 'none' || challengeArea.style.display !== 'none') {
                factDisplayArea.style.display = 'none';
                challengeArea.style.display = 'none';
                quizArea.style.display = 'block';
                toggleQuizBtn.textContent = 'Back to Facts';
                toggleChallengeBtn.style.display = 'none';
                mainTitleElement.textContent = 'Fact Quiz!';
                clearInterval(factCarouselInterval); // Stop carousel for quiz
                startQuiz();
            } else {
                quizArea.style.display = 'none';
                factDisplayArea.style.display = 'block';
                toggleQuizBtn.textContent = 'Start Fact Quiz';
                toggleChallengeBtn.style.display = 'inline-block';
                mainTitleElement.textContent = 'Cosmic Facts Explorer';
                quizScore = 0;
                quizFeedbackElement.textContent = '';
                nextQuizBtn.style.display = 'none';
                startFactCarousel(); // Restart carousel
            }
        });

        function startQuiz() {
            quizScore = 0;
            quizFeedbackElement.textContent = '';
            nextQuizBtn.style.display = 'none';
            displayQuizQuestion();
        }

        function displayQuizQuestion() {
            quizOptionsElement.innerHTML = '';
            quizFeedbackElement.textContent = '';
            nextQuizBtn.style.display = 'none';

            const randomFactIndex = Math.floor(Math.random() * facts.length);
            currentQuizFact = facts[randomFactIndex];
            quizFactElement.textContent = currentQuizFact.main;

            let options = [currentQuizFact.theme];
            while (options.length < 4) {
                const randomTheme = availableThemes[Math.floor(Math.random() * availableThemes.length)];
                if (!options.includes(randomTheme)) {
                    options.push(randomTheme);
                }
            }
            options.sort(() => Math.random() - 0.5);

            options.forEach(theme => {
                const button = document.createElement('button');
                button.textContent = theme;
                button.classList.add('quiz-option-btn');
                button.addEventListener('click', () => checkAnswer(button, theme));
                quizOptionsElement.appendChild(button);
            });
        }

        function checkAnswer(selectedButton, selectedTheme) {
            Array.from(quizOptionsElement.children).forEach(button => {
                button.disabled = true;
                if (button.textContent === currentQuizFact.theme) {
                    button.classList.add('correct');
                } else {
                    button.classList.add('incorrect');
                }
            });

            if (selectedTheme === currentQuizFact.theme) {
                quizFeedbackElement.textContent = 'Correct! 🎉';
                quizScore++;
            } else {
                quizFeedbackElement.textContent = `Incorrect. The answer was ${currentQuizFact.theme}.`;
            }
            nextQuizBtn.style.display = 'block';
        }

        nextQuizBtn.addEventListener('click', displayQuizQuestion);

        // Challenge Logic
        toggleChallengeBtn.addEventListener('click', () => {
            if (factDisplayArea.style.display !== 'none' || quizArea.style.display !== 'none') {
                factDisplayArea.style.display = 'none';
                quizArea.style.display = 'none';
                challengeArea.style.display = 'block';
                toggleChallengeBtn.textContent = 'Back to Facts';
                toggleQuizBtn.style.display = 'none';
                mainTitleElement.textContent = 'Fact Challenge!';
                clearInterval(factCarouselInterval); // Stop carousel for challenge
                startChallenge();
            } else {
                challengeArea.style.display = 'none';
                factDisplayArea.style.display = 'block';
                toggleChallengeBtn.textContent = 'Start Fact Challenge';
                toggleQuizBtn.style.display = 'inline-block';
                mainTitleElement.textContent = 'Cosmic Facts Explorer';
                challengeScore = 0;
                challengeFeedbackElement.textContent = '';
                nextChallengeBtn.style.display = 'none';
                restartChallengeBtn.style.display = 'none';
                clearInterval(challengeTimer);
                challengeStreak = 0;
                challengeStreakElement.textContent = 'Streak: 0';
                startFactCarousel(); // Restart carousel
            }
        });

        function startChallenge() {
            challengeScore = 0;
            challengeFeedbackElement.textContent = '';
            nextChallengeBtn.style.display = 'none';
            restartChallengeBtn.style.display = 'none';
            challengeStreak = 0;
            challengeStreakElement.textContent = 'Streak: 0';
            displayChallengeQuestion();
        }

        function displayChallengeQuestion() {
            clearInterval(challengeTimer);
            timeLeft = 10;
            challengeTimerText.textContent = `Time: ${timeLeft}s`;
            challengeTimerProgress.style.transition = 'none';
            challengeTimerProgress.style.width = '100%';
            void challengeTimerProgress.offsetWidth;
            challengeTimerProgress.style.transition = `width ${timeLeft}s linear`;
            challengeTimerProgress.style.width = '0%';


            challengeOptionsElement.innerHTML = '';
            challengeFeedbackElement.textContent = '';
            nextChallengeBtn.style.display = 'none';
            restartChallengeBtn.style.display = 'none';

            const randomFactIndex = Math.floor(Math.random() * facts.length);
            currentChallengeFact = facts[randomFactIndex];
            challengeFactElement.textContent = currentChallengeFact.main;

            let options = [currentChallengeFact.theme];
            while (options.length < 4) {
                const randomTheme = availableThemes[Math.floor(Math.random() * availableThemes.length)];
                if (!options.includes(randomTheme)) {
                    options.push(randomTheme);
                }
            }
            options.sort(() => Math.random() - 0.5);

            options.forEach(theme => {
                const button = document.createElement('button');
                button.textContent = theme;
                button.classList.add('challenge-option-btn');
                button.addEventListener('click', () => checkChallengeAnswer(button, theme));
                challengeOptionsElement.appendChild(button);
            });

            challengeTimer = setInterval(updateChallengeTimer, 1000);
        }

        function updateChallengeTimer() {
            timeLeft--;
            challengeTimerText.textContent = `Time: ${timeLeft}s`;
            if (timeLeft <= 0) {
                clearInterval(challengeTimer);
                challengeFeedbackElement.textContent = `Time's up! The answer was ${currentChallengeFact.theme}.`;
                Array.from(challengeOptionsElement.children).forEach(button => {
                    button.disabled = true;
                    if (button.textContent === currentChallengeFact.theme) {
                        button.classList.add('correct');
                    }
                });
                nextChallengeBtn.style.display = 'block';
                restartChallengeBtn.style.display = 'block';
                challengeStreak = 0;
                challengeStreakElement.textContent = 'Streak: 0';
            }
        }

        function checkChallengeAnswer(selectedButton, selectedTheme) {
            clearInterval(challengeTimer);
            Array.from(challengeOptionsElement.children).forEach(button => {
                button.disabled = true;
                if (button.textContent === currentChallengeFact.theme) {
                    button.classList.add('correct');
                } else {
                    button.classList.add('incorrect');
                }
            });

            if (selectedTheme === currentChallengeFact.theme) {
                challengeFeedbackElement.textContent = 'Correct! 🎉';
                challengeScore++;
                challengeStreak++;
            } else {
                challengeFeedbackElement.textContent = `Incorrect. The answer was ${currentChallengeFact.theme}.`;
                challengeStreak = 0;
            }
            challengeStreakElement.textContent = `Streak: ${challengeStreak}`;
            nextChallengeBtn.style.display = 'block';
            restartChallengeBtn.style.display = 'block';
        }

        nextChallengeBtn.addEventListener('click', displayChallengeQuestion);
        restartChallengeBtn.addEventListener('click', startChallenge);

        // Initial display
        currentFactIndex = Math.floor(Math.random() * facts.length); // Pick a random fact on load
        displayFact(currentFactIndex);
        startFactCarousel(); // Start the carousel on load

        // Keyboard navigation for facts
        document.addEventListener('keydown', (event) => {
            if (factDisplayArea.style.display !== 'none') {
                if (event.key === 'ArrowRight') {
                    currentFactIndex = (currentFactIndex + 1) % facts.length;
                    displayFact(currentFactIndex);
                    startFactCarousel(); // Reset carousel timer on manual navigation
                } else if (event.key === 'ArrowLeft') {
                    currentFactIndex = (currentFactIndex - 1 + facts.length) % facts.length;
                    displayFact(currentFactIndex);
                    startFactCarousel(); // Reset carousel timer on manual navigation
                }
            }
        });

        prevFactBtn.addEventListener('click', () => {
            currentFactIndex = (currentFactIndex - 1 + facts.length) % facts.length;
            displayFact(currentFactIndex);
            startFactCarousel(); // Reset carousel timer on manual navigation
        });

        nextFactBtn.addEventListener('click', () => {
            currentFactIndex = (currentFactIndex + 1) % facts.length;
            displayFact(currentFactIndex);
            startFactCarousel(); // Reset carousel timer on manual navigation
        });
    </script>
</body>
</html>