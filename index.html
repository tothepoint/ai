<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="site-title">Deep Sea Wonders</title>
    <style>
        :root {
            /* Theme Colors (Deep Sea Wonders) */
            --bg-color-primary: #0A1F33;   /* Very deep blue */
            --bg-color-secondary: #0F304A; /* Slightly lighter deep blue */
            --text-color: #ADD8E6;         /* Light blue, like bioluminescence */
            --footer-bg: #05101A;          /* Even darker blue */
            --glass-bg: rgba(10, 31, 51, 0.6); /* Transparent deep blue */
            --glass-border: rgba(173, 216, 230, 0.3); /* Transparent Light Blue */
            --fact-text-shadow: 2px 2px 15px rgba(0,0,0,0.9);
            --title-color: #FFD700;        /* Gold */
            --title-shadow: 4px 4px 25px rgba(0, 0, 0, 0.9);
            --button-primary: #4682B4;     /* Steel Blue */
            --button-hover: #36648B;       /* Darker Steel Blue */
            --main-action-btn: #00CED1;    /* Dark Turquoise */
            --main-action-btn-hover: #00B0B3; /* Darker Dark Turquoise */
            --reveal-overlay-color: rgba(0, 0, 0, 0.8); /* Dark overlay for hidden fact */
            --generic-title-color: #ADD8E6; /* Light blue for generic title */
            --theme-indicator-color: #FFD700; /* Gold for theme indicator */
            --favorite-btn-color: #FFD700; /* Gold for favorite button */
            --favorite-btn-hover: #B8860B; /* Dark Goldenrod */
            --star-color: #FFD700; /* Gold for stars */
            --notification-bg: rgba(0, 0, 0, 0.8);
            --notification-text: #ADD8E6;
            --correct-answer-color: #3CB371; /* Medium Sea Green */
            --incorrect-answer-color: #FF6347; /* Tomato */
        }

        #fact-streak-display {
            margin-top: 20px;
            margin-bottom: 20px;
            padding: 15px 30px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.5s ease;
        }

        #fact-streak-display p {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-color);
            margin: 0;
            text-shadow: 1px 1px 5px rgba(0,0,0,0.7);
        }

        #current-streak {
            font-size: 2rem;
            color: var(--title-color);
            font-weight: 900;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.9);
            transition: color 0.5s ease, transform 0.3s ease-out;
        }

        #current-streak.animate-pulse {
            animation: pulse 0.5s ease-out;
        }

        #reset-streak-btn {
            background-color: #6c757d; /* Grey for reset */
            color: white;
            padding: 10px 20px;
            font-size: 1rem;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
        }

        #reset-streak-btn:hover {
            background-color: #5a6268;
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(0,0,0,0.4);
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        body {
            background: linear-gradient(135deg, var(--bg-color-primary) 0%, var(--bg-color-secondary) 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
            transition: background 1.5s ease-in-out, color 0.8s ease;
            overflow-x: hidden;
            position: relative; /* For bubble animation */
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .container {
            max-width: 1000px;
            width: 100%;
            margin-bottom: 20px;
            padding: 50px;
            background-color: var(--glass-bg);
            border-radius: 25px;
            box-shadow: 0 15px 50px 0 rgba( 0, 0, 0, 0.5 );
            backdrop-filter: blur( 12px );
            -webkit-backdrop-filter: blur( 12px );
            border: 1px solid var(--glass-border);
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        h1#main-title {
            font-size: 4.5rem;
            margin-bottom: 1rem;
            text-shadow: var(--title-shadow);
            color: var(--title-color);
            letter-spacing: 3px;
            font-weight: 900;
            transition: color 1s ease;
        }
        #theme-indicator {
            font-size: 1.5rem;
            color: var(--theme-indicator-color);
            margin-bottom: 3rem;
            font-style: italic;
            opacity: 0.8;
            transition: color 1s ease;
        }

        #theme-selector-container {
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        #theme-selector-container label {
            font-size: 1.3rem;
            color: var(--text-color);
            font-weight: 600;
        }

        #theme-select {
            padding: 10px 20px;
            font-size: 1.1rem;
            border-radius: 10px;
            border: 1px solid var(--glass-border);
            background-color: var(--glass-bg);
            color: var(--text-color);
            cursor: pointer;
            appearance: none; /* Remove default dropdown arrow */
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23FFD700%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-6.5%200-12.3%203.2-16.1%208.1-3.8%204.9-4.9%2011.4-3.1%2017.4l130%20140c3.8%204.9%209.6%208.1%2016.1%208.1s12.3-3.2%2016.1-8.1l130-140c1.8-6-.1-12.5-3.9-17.4z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 1em;
            padding-right: 40px; /* Make space for the custom arrow */
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        #theme-select:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }

        #theme-select option {
            background-color: var(--bg-color-primary);
            color: var(--text-color);
        }

        p {
            font-size: 2.2rem;
            line-height: 1.6;
            margin-bottom: 2.5rem;
            cursor: default;
            transition: transform 0.3s ease-in-out, color 0.3s ease-in-out;
            text-shadow: var(--fact-text-shadow);
            font-weight: 600;
        }
        #main-fact-container {
            margin-top: 30px;
            margin-bottom: 30px;
            padding: 35px 45px;
            background-color: var(--glass-bg);
            border-radius: 25px;
            box-shadow: 0 10px 35px rgba(0,0,0,0.5);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            cursor: default;
            transition: all 0.5s ease, transform 0.3s ease-out;
            position: relative;
            overflow: hidden;
            max-width: 900px;
            width: 90%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 200px;
        }
        #main-fact-text {
            font-size: 2.8rem; /* Increased font size */
            color: var(--text-color);
            background-color: transparent;
            padding: 15px 25px;
            border-radius: 12px;
            font-style: italic;
            font-weight: 700;
            text-shadow: var(--fact-text-shadow);
            transition: color 1s ease, background-color 1s ease, filter 1s ease, opacity 1s ease, text-shadow 1s ease, transform 0.5s ease;
            line-height: 1.5;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
            z-index: 1;
            filter: blur(8px); /* Blurred initially */
            opacity: 0.3; /* Less opaque initially */
        }
        #main-fact-container.revealed #main-fact-text {
            filter: blur(0px); /* Not blurred when revealed */
            opacity: 1; /* Fully opaque when revealed */
            transform: scale(1.05); /* Slightly larger when revealed */
            animation: bioluminescent-glow 1.5s infinite alternate; /* Bioluminescent glow */
        }
        #main-fact-container.revealed #main-fact-text.animate-in {
            animation: fadeInScale 0.8s ease-out forwards;
        }
        #reveal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--reveal-overlay-color);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2;
            transition: opacity 0.5s ease-out;
        }
        #main-fact-container.revealed #reveal-overlay {
            opacity: 0;
            pointer-events: none; /* Allow clicks to pass through once hidden */
        }
        #reveal-fact-btn {
            padding: 20px 40px;
            font-size: 1.8rem;
            font-weight: bold;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            background-color: var(--main-action-btn);
            color: white;
            box-shadow: 0 8px 25px rgba(0,0,0,0.5);
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
            animation: pulse 2s infinite; /* Added pulse animation */
        }
        #reveal-fact-btn:hover {
            background-color: var(--main-action-btn-hover);
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 12px 30px rgba(0,0,0,0.6);
            animation: none; /* Stop pulse on hover */
        }
        #did-you-know {
            margin-top: 30px;
            padding-top: 25px;
            border-top: 1px solid rgba(255, 255, 255, 0.3);
            text-align: left;
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            transition: max-height 1s ease-out, opacity 1s ease-out, transform 1s ease-out;
            transform: translateY(20px);
            width: 90%;
            max-width: 850px;
            background-color: rgba(0,0,0,0.2); /* Subtle background for emphasis */
            border-radius: 10px;
            padding: 25px;
            box-sizing: border-box;
        }
        #did-you-know.visible {
            max-height: 200px; /* Adjusted for content */
            opacity: 1;
            transform: translateY(0);
        }
        #did-you-know h3 {
            color: var(--generic-title-color);
            font-size: 1.8rem;
            margin-bottom: 15px;
            text-shadow: 1px 1px 8px rgba(0,0,0,0.7);
        }
        #did-you-know p {
            font-size: 1.4rem;
            line-height: 1.4;
            color: var(--text-color);
            text-shadow: none;
            font-weight: 400;
        }
        .button-group {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;\n            justify-content: center;\n        }\n        .button-group.primary-actions {\n            margin-top: 40px;\n            margin-bottom: 20px;\n        }\n        .button-group.secondary-actions {\n            margin-bottom: 20px;\n        }\n        .button-group.utility-actions {\n            margin-bottom: 40px;\n        }\n        .action-button {\n            padding: 15px 30px;\n            font-size: 1.3rem;\n            font-weight: bold;\n            border: none;\n            border-radius: 10px;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            box-shadow: 0 5px 15px rgba(0,0,0,0.3);\n            text-transform: uppercase;\n            letter-spacing: 1px;\n        }\n        .action-button:disabled {\n            opacity: 0.5;\n            cursor: not-allowed;\n            box-shadow: none;\n            transform: none;\n        }\n        #toggle-did-you-know-btn {\n            background-color: var(--main-action-btn);\n            color: white;\n        }\n        #toggle-did-you-know-btn:hover {\n            background-color: var(--main-action-btn-hover);\n            transform: translateY(-3px);\n            box-shadow: 0 8px 20px rgba(0,0,0,0.4);\n        }\n        #new-fact-btn {\n            background-color: var(--button-primary);\n            color: white;\n        }\n        #new-fact-btn:hover {\n            background-color: var(--button-hover);\n            transform: translateY(-3px);\n            box-shadow: 0 8px 20px rgba(0,0,0,0.4);\n        }\n        #copy-fact-btn, #share-twitter-btn, #share-whatsapp-btn {\n            background-color: #555; /* A neutral grey */\n            color: white;\n            padding: 10px 20px;\n            font-size: 1rem;\n            margin-top: 15px;\n        }\n        #copy-fact-btn:hover, #share-twitter-btn:hover, #share-whatsapp-btn:hover {\n            background-color: #777;\n            transform: translateY(-2px);\n        }\n        #favorite-fact-btn {\n            background-color: var(--favorite-btn-color);\n            color: black; /* Black text for gold button */\n        }\n        #favorite-fact-btn:hover {\n            background-color: var(--favorite-btn-hover);\n            transform: translateY(-3px);\n            box-shadow: 0 8px 20px rgba(0,0,0,0.4);\n        }\n        #favorite-fact-btn.favorited {\n            background-color: #FFEB3B; /* Lighter yellow when favorited */\n            color: #B71C1C; /* Red text for contrast */\n            box-shadow: 0 0 15px 5px rgba(255, 215, 0, 0.7);\n        }\n\n        #favorite-facts-display, #fact-history-display {\n            margin-top: 40px;\n            padding: 25px;\n            background-color: rgba(0,0,0,0.3);\n            border-radius: 15px;\n            width: 90%;\n            max-width: 850px;\n            text-align: left;\n            box-shadow: inset 0 0 15px rgba(0,0,0,0.5);\n            display: none; /* Hidden by default */\n            flex-direction: column;\n            gap: 15px;\n        }\n        #favorite-facts-display.visible, #fact-history-display.visible {\n            display: flex;\n        }\n        #favorite-facts-display h3, #fact-history-display h3 {\n            color: var(--generic-title-color);\n            font-size: 1.8rem;\n            margin-bottom: 15px;\n            text-shadow: 1px 1px 8px rgba(0,0,0,0.7);\n            text-align: center;\n        }\n        .favorite-fact-item, .history-fact-item {\n            background-color: rgba(255,255,255,0.1);\n            padding: 15px;\n            border-radius: 10px;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            font-size: 1.1rem;\n            line-height: 1.4;\n            border: 1px solid rgba(255,255,255,0.2);\n        }\n        .favorite-fact-item .remove-fav-btn, .history-fact-item .remove-history-btn {\n            background-color: #DC3545; /* Red for remove */\n            color: white;\n            border: none;\n            padding: 8px 12px;\n            border-radius: 5px;\n            cursor: pointer;\n            font-size: 0.9rem;\n            transition: background-color 0.3s ease;\n        }\n        .favorite-fact-item .remove-fav-btn:hover, .history-fact-item .remove-history-btn:hover {\n            background-color: #C82333;\n        }\n\n        /* Fact Rating Feature Styles */\n        #fact-rating-container {\n            margin-top: 20px;\n            display: none; /* Hidden initially */\n            flex-direction: column;\n            align-items: center;\n            gap: 10px;\n            opacity: 0;\n            transition: opacity 0.5s ease-out;\n        }\n        #fact-rating-container.visible {\n            display: flex;\n            opacity: 1;\n        }\n        .star-rating {\n            display: flex;\n            gap: 5px;\n        }\n        .star-rating .star {\n            font-size: 2.5rem;\n            color: #555; /* Default grey for unselected stars */\n            cursor: pointer;\n            transition: color 0.2s ease, transform 0.2s ease;\n        }\n        .star-rating .star.selected {\n            color: var(--star-color); /* Use theme color for selected stars */\n            transform: scale(1.2);\n        }\n        footer {\n            width: 100%;\n            padding: 15px 0;\n            background-color: var(--footer-bg); /* Use theme variable */\n            color: var(--text-color); /* Ensure footer text color matches theme */\n            font-size: 1rem;\n            margin-top: auto; /* Pushes footer to the bottom */\n            opacity: 0.9;\n            box-shadow: 0 -5px 15px rgba(0,0,0,0.3);\n            transition: background-color 1s ease, color 1s ease;\n        }\n        footer p {\n            color: var(--text-color); /* Ensure footer text color matches theme */\n            font-size: 1rem;\n            margin: 0;\n            opacity: 0.7;\n        }\n\n        .quiz-option-btn {\n            background-color: var(--button-primary);\n            color: white;\n            padding: 12px 25px;\n            font-size: 1.1rem;\n            border: none;\n            border-radius: 8px;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            margin: 5px;\n            box-shadow: 0 4px 15px rgba(0,0,0,0.2);\n        }\n\n        .quiz-option-btn:hover {\n            background-color: var(--button-hover);\n            transform: translateY(-2px);\n            box-shadow: 0 6px 20px rgba(0,0,0,0.3);\n        }\n\n        .quiz-option-btn.selected {\n            background-color: var(--main-action-btn);\n            transform: scale(1.05);\n            box-shadow: 0 6px 20px rgba(0,0,0,0.4);\n        }\n\n        .quiz-option-btn.correct {\n            background-color: var(--correct-answer-color);\n            color: white;\n            font-weight: bold;\n            animation: pulseCorrect 0.5s ease-out;\n        }\n\n        .quiz-option-btn.incorrect {\n            background-color: var(--incorrect-answer-color);\n            color: white;\n            font-weight: bold;\n            animation: shake 0.3s ease-out;\n        }\n\n        @keyframes pulseCorrect {\n            0% { transform: scale(1); }\n            50% { transform: scale(1.08); }\n            100% { transform: scale(1); }\n        }\n\n        @keyframes shake {\n            0% { transform: translateX(0); }\n            25% { transform: translateX(-5px); }\n            50% { transform: translateX(5px); }\n            75% { transform: translateX(-5px); }\n            100% { transform: translateX(0); }\n        }\n\n        /* Mastery Progress Bar Styling */\n        #fact-mastery-display {\n            margin-top: 20px;\n            margin-bottom: 20px;\n            padding: 15px 30px;\n            background-color: rgba(255, 255, 255, 0.1);\n            border-radius: 15px;\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            gap: 10px;\n            box-shadow: 0 5px 20px rgba(0,0,0,0.3);\n            border: 1px solid rgba(255, 255, 255, 0.2);\n            transition: all 0.5s ease;\n            color: var(--text-color);\n            font-size: 1.3rem;\n            font-weight: 600;\n            text-shadow: 1px 1px 5px rgba(0,0,0,0.7);\n        }\n\n        #mastery-progress-bar-container {\n            width: 80%;\n            background-color: rgba(0,0,0,0.3);\n            border-radius: 10px;\n            height: 15px;\n            overflow: hidden;\n            box-shadow: inset 0 2px 5px rgba(0,0,0,0.5);\n        }\n\n        #mastery-progress-bar {\n            height: 100%;\n            width: 0%; /* Initial width */\n            background-color: var(--title-color); /* Use a theme color for progress */\n            border-radius: 10px;\n            transition: width 0.5s ease-in-out;\n        }\n\n        #fact-quiz-container h3, #fact-challenge-container h3 {\n            color: var(--generic-title-color);\n            font-size: 2rem; /* Slightly larger */\n            margin-bottom: 20px;\n            text-shadow: 2px 2px 10px rgba(0,0,0,0.8); /* Stronger shadow */\n            transition: text-shadow 0.5s ease;\n        }\n\n        #fact-challenge-container {\n            margin-top: 30px;\n            padding: 25px;\n            background-color: var(--glass-bg);\n            border-radius: 15px;\n            box-shadow: 0 10px 35px rgba(0,0,0,0.5);\n            backdrop-filter: blur(12px);\n            -webkit-backdrop-filter: blur(12px);\n            border: 1px solid var(--glass-border);\n            width: 90%;\n            max-width: 850px;\n            display: none; /* Hidden by default */\n            flex-direction: column;\n            align-items: center;\n            gap: 20px;\n            opacity: 0;\n            transition: opacity 0.5s ease-out;\n        }\n\n        #fact-challenge-container.visible {\n            display: flex;\n            opacity: 1;\n        }\n\n        #challenge-question {\n            font-size: 1.8rem;\n            color: var(--text-color);\n            margin-bottom: 20px;\n            text-shadow: 1px 1px 8px rgba(0,0,0,0.7);\n            text-align: center;\n        }\n\n        #challenge-options {\n            display: flex;\n            flex-wrap: wrap;\n            justify-content: center;\n            gap: 15px;\n        }\n\n        .challenge-option-btn {\n            background-color: var(--button-primary);\n            color: white;\n            padding: 15px 30px;\n            font-size: 1.2rem;\n            border: none;\n            border-radius: 10px;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            box-shadow: 0 4px 15px rgba(0,0,0,0.2);\n        }\n\n        .challenge-option-btn:hover {\n            background-color: var(--button-hover);\n            transform: translateY(-3px);\n            box-shadow: 0 6px 20px rgba(0,0,0,0.3);\n        }\n\n        .challenge-option-btn.correct {\n            background-color: var(--correct-answer-color);\n            color: white;\n            font-weight: bold;\n            animation: pulseCorrect 0.5s ease-out;\n        }\n\n        .challenge-option-btn.incorrect {\n            background-color: var(--incorrect-answer-color);\n            color: white;\n            font-weight: bold;\n            animation: shake 0.3s ease-out;\n        }\n\n        #challenge-feedback {\n            font-size: 1.5rem;\n            font-weight: bold;\n            margin-top: 20px;\n            min-height: 30px;\n        }\n\n        #next-challenge-btn {\n            background-color: var(--main-action-btn);\n            color: white;\n            padding: 15px 30px;\n            font-size: 1.3rem;\n            border: none;\n            border-radius: 10px;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            box-shadow: 0 5px 15px rgba(0,0,0,0.3);\n            margin-top: 20px;\n        }\n\n        #next-challenge-btn:hover {\n            background-color: var(--main-action-btn-hover);\n            transform: translateY(-3px);\n            box-shadow: 0 8px 20px rgba(0,0,0,0.4);\n        }\n\n        /* Bioluminescent Glow Animation */\n        @keyframes bioluminescent-glow {\n            0% { box-shadow: 0 0 15px var(--text-color), 0 0 30px var(--text-color); }\n            100% { box-shadow: 0 0 25px var(--text-color), 0 0 45px var(--text-color); }\n        }\n\n        /* Bubble Animation */\n        .bubble {\n            position: absolute;\n            bottom: -10px;\n            width: 10px;\n            height: 10px;\n            background-color: rgba(173, 216, 230, 0.5); /* Light blue, semi-transparent */\n            border-radius: 50%;\n            opacity: 0;\n            animation: bubble-rise 10s infinite ease-in-out;\n            pointer-events: none;\n            z-index: 0;\n        }\n\n        .bubble:nth-child(1) { left: 10%; animation-duration: 8s; animation-delay: 0s; transform: scale(0.8); }\n        .bubble:nth-child(2) { left: 20%; animation-duration: 12s; animation-delay: 2s; transform: scale(1.2); }\n        .bubble:nth-child(3) { left: 30%; animation-duration: 7s; animation-delay: 1s; transform: scale(0.7); }\n        .bubble:nth-child(4) { left: 40%; animation-duration: 11s; animation-delay: 3s; transform: scale(1.1); }\n        .bubble:nth-child(5) { left: 50%; animation-duration: 9s; animation-delay: 0.5s; transform: scale(0.9); }\n        .bubble:nth-child(6) { left: 60%; animation-duration: 13s; animation-delay: 4s; transform: scale(1.3); }\n        .bubble:nth-child(7) { left: 70%; animation-duration: 6s; animation-delay: 2.5s; transform: scale(0.6); }\n        .bubble:nth-child(8) { left: 80%; animation-duration: 10s; animation-delay: 1.5s; transform: scale(1.0); }\n        .bubble:nth-child(9) { left: 90%; animation-duration: 14s; animation-delay: 3.5s; transform: scale(1.4); }\n\n        @keyframes bubble-rise {\n            0% { bottom: -10px; opacity: 0; transform: translateX(0) scale(1); }\n            10% { opacity: 1; }\n            80% { opacity: 1; }\n            100% { bottom: 100%; opacity: 0; transform: translateX(20px) scale(1.2); }\n        }\n\n    </style>
</head>
<body>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>

    <div class="container">
        <h1 id="main-title">Deep Sea Wonders</h1>
        <p id="theme-indicator">Exploring the Ocean's Depths</p>

        <div id="theme-selector-container">
            <label for="theme-select">Choose Your Journey:</label>
            <select id="theme-select">
                <option value="quantum-quirks">Quantum Quirks</option>
                <option value="deep-sea-mysteries" selected>Deep Sea Mysteries</option>
                <option value="ancient-civilizations">Ancient Civilizations</option>
                <option value="incredible-animals">Incredible Animals</option>
                <option value="human-body-wonders">Human Body Wonders</option>
            </select>
        </div>

        <div id="main-fact-container">
            <p id="main-fact-text">The Mariana Trench is deeper than Mount Everest is tall.</p>
            <div id="reveal-overlay">
                <button id="reveal-fact-btn">Reveal the Deep Secret!</button>
            </div>
        </div>

        <div class="button-group primary-actions">
            <button id="new-fact-btn" class="action-button">New Deep Dive Fact</button>
            <button id="favorite-fact-btn" class="action-button">⭐ Favorite Fact</button>
        </div>

        <div id="fact-rating-container">
            <p>Rate this fact:</p>
            <div class="star-rating">
                <span class="star" data-value="1">★</span>
                <span class="star" data-value="2">★</span>
                <span class="star" data-value="3">★</span>
                <span class="star" data-value="4">★</span>
                <span class="star" data-value="5">★</span>
            </div>
        </div>

        <div id="fact-streak-display">
            <p>Current Streak: <span id="current-streak">0</span></p>
            <button id="reset-streak-btn" class="action-button">Reset Streak</button>
        </div>

        <div id="fact-mastery-display">
            <p>Fact Mastery Progress:</p>
            <div id="mastery-progress-bar-container">
                <div id="mastery-progress-bar"></div>
            </div>
            <p><span id="mastered-facts-count">0</span> / <span id="total-facts-count">0</span> Mastered</p>
        </div>

        <div class="button-group secondary-actions">
            <button id="toggle-did-you-know-btn" class="action-button">Did You Know?</button>
            <button id="toggle-quiz-btn" class="action-button">Fact Quiz</button>
            <button id="toggle-challenge-btn" class="action-button">Fact Challenge</button>
        </div>

        <div id="did-you-know">
            <h3>Did You Know?</h3>
            <p id="did-you-know-text">The Mariana Trench is located in the western Pacific Ocean, near the Mariana Islands. It is the deepest oceanic trench on Earth and the deepest part of the Earth's hydrosphere.</p>
        </div>

        <div id="fact-quiz-container">
            <h3>Test Your Knowledge!</h3>
            <p id="quiz-question"></p>
            <div id="quiz-options"></div>
            <p id="quiz-feedback"></p>
            <button id="next-quiz-btn" class="action-button">Next Question</button>
        </div>

        <div id="fact-challenge-container">
            <h3>Challenge Yourself!</h3>
            <p id="challenge-question"></p>
            <div id="challenge-options"></div>
            <p id="challenge-feedback"></p>
            <button id="next-challenge-btn" class="action-button">Next Challenge</button>
        </div>

        <div class="button-group utility-actions">
            <button id="copy-fact-btn" class="action-button">Copy Fact</button>
            <button id="share-twitter-btn" class="action-button">Share on Twitter</button>
            <button id="share-whatsapp-btn" class="action-button">Share on WhatsApp</button>
            <button id="toggle-favorites-btn" class="action-button">My Favorite Facts</button>
            <button id="toggle-history-btn" class="action-button">Fact History</button>
        </div>

        <div id="favorite-facts-display">
            <h3>My Favorite Facts</h3>
            <div id="favorite-facts-list"></div>
        </div>

        <div id="fact-history-display">
            <h3>Fact History</h3>
            <div id="fact-history-list"></div>
        </div>

    </div>

    <footer>
        <p>Site will update at: <span id="update-time"></span></p>
    </footer>

    <script>
        const themes = {
            "quantum-quirks": {
                title: "Quantum Quirks",
                indicator: "Exploring the Subatomic Realm",
                fact: "Quantum entanglement allows particles to be linked in such a way that they share the same existence, no matter how far apart they are.",
                didYouKnow: "This phenomenon, famously dubbed 'spooky action at a distance' by Albert Einstein, is a cornerstone of quantum mechanics and has profound implications for future technologies like quantum computing and cryptography.",
                colors: {
                    "--bg-color-primary": "#2A0A4A",
                    "--bg-color-secondary": "#3F156B",
                    "--text-color": "#E0BBE4",
                    "--footer-bg": "#1F0738",
                    "--glass-bg": "rgba(42, 10, 74, 0.6)",
                    "--glass-border": "rgba(224, 187, 228, 0.3)",
                    "--title-color": "#DAA520",
                    "--main-action-btn": "#FF6347",
                    "--main-action-btn-hover": "#E5533D",
                    "--button-primary": "#8A2BE2",
                    "--button-hover": "#6A0DAD",
                    "--favorite-btn-color": "#DAA520",
                    "--favorite-btn-hover": "#B8860B",
                    "--star-color": "#FFD700",
                    "--generic-title-color": "#E0BBE4",
                    "--theme-indicator-color": "#DAA520",
                }
            },
            "deep-sea-mysteries": {
                title: "Deep Sea Wonders",
                indicator: "Exploring the Ocean's Depths",
                fact: "The Mariana Trench is deeper than Mount Everest is tall.",
                didYouKnow: "The Mariana Trench is located in the western Pacific Ocean, near the Mariana Islands. It is the deepest oceanic trench on Earth and the deepest part of the Earth's hydrosphere.",
                colors: {
                    "--bg-color-primary": "#0A1F33",
                    "--bg-color-secondary": "#0F304A",
                    "--text-color": "#ADD8E6",
                    "--footer-bg": "#05101A",
                    "--glass-bg": "rgba(10, 31, 51, 0.6)",
                    "--glass-border": "rgba(173, 216, 230, 0.3)",
                    "--title-color": "#FFD700",
                    "--main-action-btn": "#00CED1",
                    "--main-action-btn-hover": "#00B0B3",
                    "--button-primary": "#4682B4",
                    "--button-hover": "#36648B",
                    "--favorite-btn-color": "#FFD700",
                    "--favorite-btn-hover": "#B8860B",
                    "--star-color": "#FFD700",
                    "--generic-title-color": "#ADD8E6",
                    "--theme-indicator-color": "#FFD700",
                }
            },
            "ancient-civilizations": {
                title: "Echoes of Ancients",
                indicator: "Unearthing Forgotten Worlds",
                fact: "The Great Pyramid of Giza was the tallest man-made structure for over 3,800 years.",
                didYouKnow: "Built for Pharaoh Khufu, its construction is estimated to have taken 20 years, using over 2.3 million stone blocks. It remained the tallest man-made structure until the Lincoln Cathedral was completed in 1311 AD.",
                colors: {
                    "--bg-color-primary": "#4A3C2A",
                    "--bg-color-secondary": "#6B5B3F",
                    "--text-color": "#F5DEB3",
                    "--footer-bg": "#382E1F",
                    "--glass-bg": "rgba(74, 60, 42, 0.6)",
                    "--glass-border": "rgba(245, 222, 179, 0.3)",
                    "--title-color": "#DAA520",
                    "--main-action-btn": "#CD853F",
                    "--main-action-btn-hover": "#B87333",
                    "--button-primary": "#A0522D",
                    "--button-hover": "#8B4513",
                    "--favorite-btn-color": "#DAA520",
                    "--favorite-btn-hover": "#B8860B",
                    "--star-color": "#FFD700",
                    "--generic-title-color": "#F5DEB3",
                    "--theme-indicator-color": "#DAA520",
                }
            },
            "incredible-animals": {
                title: "Wild Wonders",
                indicator: "The Animal Kingdom's Secrets",
                fact: "A group of owls is called a parliament.",
                didYouKnow: "This charming collective noun is thought to have originated from the perception of owls as wise and scholarly creatures, often depicted in folklore and literature as deliberating in solemn assembly.",
                colors: {
                    "--bg-color-primary": "#224229",
                    "--bg-color-secondary": "#3A6040",
                    "--text-color": "#C8E6C9",
                    "--footer-bg": "#1A301F",
                    "--glass-bg": "rgba(34, 66, 41, 0.6)",
                    "--glass-border": "rgba(200, 230, 201, 0.3)",
                    "--title-color": "#FFD700",
                    "--main-action-btn": "#4CAF50",
                    "--main-action-btn-hover": "#43A047",
                    "--button-primary": "#66BB6A",
                    "--button-hover": "#4CAF50",
                    "--favorite-btn-color": "#FFD700",
                    "--favorite-btn-hover": "#B8860B",
                    "--star-color": "#FFD700",
                    "--generic-title-color": "#C8E6C9",
                    "--theme-indicator-color": "#FFD700",
                }
            },
            "human-body-wonders": {
                title: "Body's Blueprint",
                indicator: "The Marvels Within Us",
                fact: "Your brain uses about 20% of your body's oxygen and calories.",
                didYouKnow: "Despite making up only about 2% of an adult's body weight, the brain is an incredibly energy-intensive organ, requiring a constant and significant supply of oxygen and nutrients to function optimally.",
                colors: {
                    "--bg-color-primary": "#4A0A0A",
                    "--bg-color-secondary": "#6B1515",
                    "--text-color": "#FFCCCC",
                    "--footer-bg": "#380707",
                    "--glass-bg": "rgba(74, 10, 10, 0.6)",
                    "--glass-border": "rgba(255, 204, 204, 0.3)",
                    "--title-color": "#FFD700",
                    "--main-action-btn": "#DC143C",
                    "--main-action-btn-hover": "#C41134",
                    "--button-primary": "#B22222",
                    "--button-hover": "#8B0000",
                    "--favorite-btn-color": "#FFD700",
                    "--favorite-btn-hover": "#B8860B",
                    "--star-color": "#FFD700",
                    "--generic-title-color": "#FFCCCC",
                    "--theme-indicator-color": "#FFD700",
                }
            }
        };

        let currentTheme = "deep-sea-mysteries";
        let currentFact = "";
        let currentDidYouKnow = "";
        let factHistory = [];
        let favoriteFacts = JSON.parse(localStorage.getItem('favoriteFacts')) || [];
        let factRatings = JSON.parse(localStorage.getItem('factRatings')) || {};
        let factStreaks = JSON.parse(localStorage.getItem('factStreaks')) || {};
        let masteredFacts = JSON.parse(localStorage.getItem('masteredFacts')) || {};

        const siteTitle = document.getElementById('site-title');
        const mainTitle = document.getElementById('main-title');
        const themeIndicator = document.getElementById('theme-indicator');
        const themeSelect = document.getElementById('theme-select');
        const mainFactContainer = document.getElementById('main-fact-container');
        const mainFactText = document.getElementById('main-fact-text');
        const revealOverlay = document.getElementById('reveal-overlay');
        const revealFactBtn = document.getElementById('reveal-fact-btn');
        const newFactBtn = document.getElementById('new-fact-btn');
        const favoriteFactBtn = document.getElementById('favorite-fact-btn');
        const toggleDidYouKnowBtn = document.getElementById('toggle-did-you-know-btn');
        const didYouKnowSection = document.getElementById('did-you-know');
        const didYouKnowText = document.getElementById('did-you-know-text');
        const copyFactBtn = document.getElementById('copy-fact-btn');
        const shareTwitterBtn = document.getElementById('share-twitter-btn');
        const shareWhatsappBtn = document.getElementById('share-whatsapp-btn');
        const toggleFavoritesBtn = document.getElementById('toggle-favorites-btn');
        const favoriteFactsDisplay = document.getElementById('favorite-facts-display');
        const favoriteFactsList = document.getElementById('favorite-facts-list');
        const toggleHistoryBtn = document.getElementById('toggle-history-btn');
        const factHistoryDisplay = document.getElementById('fact-history-display');
        const factHistoryList = document.getElementById('fact-history-list');
        const factRatingContainer = document.getElementById('fact-rating-container');
        const stars = document.querySelectorAll('.star-rating .star');
        const factStreakDisplay = document.getElementById('fact-streak-display');
        const currentStreakSpan = document.getElementById('current-streak');
        const resetStreakBtn = document.getElementById('reset-streak-btn');
        const toggleQuizBtn = document.getElementById('toggle-quiz-btn');
        const factQuizContainer = document.getElementById('fact-quiz-container');
        const quizQuestion = document.getElementById('quiz-question');
        const quizOptions = document.getElementById('quiz-options');
        const quizFeedback = document.getElementById('quiz-feedback');
        const nextQuizBtn = document.getElementById('next-quiz-btn');
        const factMasteryDisplay = document.getElementById('fact-mastery-display');
        const masteryProgressBar = document.getElementById('mastery-progress-bar');
        const masteredFactsCountSpan = document.getElementById('mastered-facts-count');
        const totalFactsCountSpan = document.getElementById('total-facts-count');
        const toggleChallengeBtn = document.getElementById('toggle-challenge-btn');
        const factChallengeContainer = document.getElementById('fact-challenge-container');
        const challengeQuestion = document.getElementById('challenge-question');
        const challengeOptions = document.getElementById('challenge-options');
        const challengeFeedback = document.getElementById('challenge-feedback');
        const nextChallengeBtn = document.getElementById('next-challenge-btn');

        let quizMode = false;
        let challengeMode = false;
        let currentQuizFact = null;
        let currentChallengeFact = null;
        let currentChallengeCorrectOption = null;

        function applyTheme(themeName) {
            const theme = themes[themeName];
            if (!theme) return;

            siteTitle.textContent = theme.title;
            mainTitle.textContent = theme.title;
            themeIndicator.textContent = theme.indicator;
            mainFactText.textContent = theme.fact;
            didYouKnowText.textContent = theme.didYouKnow;
            currentFact = theme.fact;
            currentDidYouKnow = theme.didYouKnow;

            for (const [prop, value] of Object.entries(theme.colors)) {
                document.documentElement.style.setProperty(prop, value);
            }

            // Update the selected option in the dropdown
            themeSelect.value = themeName;

            // Reset UI elements
            mainFactContainer.classList.remove('revealed');
            mainFactText.classList.remove('animate-in');
            didYouKnowSection.classList.remove('visible');
            factRatingContainer.classList.remove('visible');
            favoriteFactBtn.classList.remove('favorited');
            resetStars();
            updateFavoriteButtonState();
            updateFactStreakDisplay();
            updateMasteryDisplay();
            hideQuiz();
            hideChallenge();
        }

        function getRandomFact(excludeFact = null) {
            const theme = themes[currentTheme];
            let fact = theme.fact;
            let didYouKnow = theme.didYouKnow;

            // In a real application, you'd have an array of facts per theme
            // For this example, we only have one fact per theme, so we'll just return it.
            // If we had multiple, we'd pick a random one that isn't the excludeFact.
            return { fact, didYouKnow };
        }

        function showNewFact() {
            const { fact, didYouKnow } = getRandomFact(currentFact);
            currentFact = fact;
            currentDidYouKnow = didYouKnow;
            mainFactText.textContent = currentFact;
            didYouKnowText.textContent = currentDidYouKnow;

            mainFactContainer.classList.remove('revealed');
            mainFactText.classList.remove('animate-in');
            didYouKnowSection.classList.remove('visible');
            factRatingContainer.classList.remove('visible');
            favoriteFactBtn.classList.remove('favorited');
            resetStars();
            updateFavoriteButtonState();
            addFactToHistory(currentFact);
            updateFactStreakDisplay();
            updateMasteryDisplay();
            hideQuiz();
            hideChallenge();
        }

        function updateFavoriteButtonState() {
            if (favoriteFacts.includes(currentFact)) {
                favoriteFactBtn.classList.add('favorited');
                favoriteFactBtn.textContent = '❤️ Favorited!';
            } else {
                favoriteFactBtn.classList.remove('favorited');
                favoriteFactBtn.textContent = '⭐ Favorite Fact';
            }
        }

        function toggleFavoriteFact() {
            if (favoriteFacts.includes(currentFact)) {
                favoriteFacts = favoriteFacts.filter(fact => fact !== currentFact);
            } else {
                favoriteFacts.push(currentFact);
            }
            localStorage.setItem('favoriteFacts', JSON.stringify(favoriteFacts));
            updateFavoriteButtonState();
            renderFavoriteFacts();
        }

        function renderFavoriteFacts() {
            favoriteFactsList.innerHTML = '';
            if (favoriteFacts.length === 0) {
                favoriteFactsList.innerHTML = '<p>No favorite facts yet. Star some facts to save them!</p>';
                return;
            }
            favoriteFacts.forEach(fact => {
                const factItem = document.createElement('div');
                factItem.classList.add('favorite-fact-item');
                factItem.innerHTML = `
                    <span>${fact}</span>
                    <button class="remove-fav-btn" data-fact="${fact}">Remove</button>
                `;
                favoriteFactsList.appendChild(factItem);
            });

            document.querySelectorAll('.remove-fav-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const factToRemove = e.target.dataset.fact;
                    favoriteFacts = favoriteFacts.filter(fact => fact !== factToRemove);
                    localStorage.setItem('favoriteFacts', JSON.stringify(favoriteFacts));
                    renderFavoriteFacts();
                    updateFavoriteButtonState();
                });
            });
        }

        function addFactToHistory(fact) {
            if (!factHistory.includes(fact)) {
                factHistory.unshift(fact); // Add to the beginning
                if (factHistory.length > 10) { // Keep history to last 10 facts
                    factHistory.pop();
                }
                localStorage.setItem('factHistory', JSON.stringify(factHistory));
            }
            renderFactHistory();
        }

        function renderFactHistory() {
            factHistoryList.innerHTML = '';
            if (factHistory.length === 0) {
                factHistoryList.innerHTML = '<p>No fact history yet. Start exploring!</p>';
                return;
            }
            factHistory.forEach(fact => {
                const factItem = document.createElement('div');
                factItem.classList.add('history-fact-item');
                factItem.innerHTML = `
                    <span>${fact}</span>
                `;
                factHistoryList.appendChild(factItem);
            });
        }

        function resetStars() {
            stars.forEach(star => star.classList.remove('selected'));
        }

        function setRating(rating) {
            resetStars();
            for (let i = 0; i < rating; i++) {
                stars[i].classList.add('selected');
            }
            factRatings[currentFact] = rating;
            localStorage.setItem('factRatings', JSON.stringify(factRatings));
            updateMasteryDisplay();
        }

        function updateFactStreakDisplay() {
            const streak = factStreaks[currentTheme] || 0;
            currentStreakSpan.textContent = streak;
            if (streak > 0) {
                currentStreakSpan.classList.add('animate-pulse');
                setTimeout(() => currentStreakSpan.classList.remove('animate-pulse'), 500);
            }
        }

        function incrementStreak() {
            factStreaks[currentTheme] = (factStreaks[currentTheme] || 0) + 1;
            localStorage.setItem('factStreaks', JSON.stringify(factStreaks));
            updateFactStreakDisplay();
        }

        function resetStreak() {
            factStreaks[currentTheme] = 0;
            localStorage.setItem('factStreaks', JSON.stringify(factStreaks));
            updateFactStreakDisplay();
        }

        function updateMasteryDisplay() {
            const allFactsInTheme = Object.values(themes).map(t => t.fact); // Simplified for this example
            totalFactsCountSpan.textContent = allFactsInTheme.length;

            const masteredCount = Object.keys(masteredFacts).filter(fact => allFactsInTheme.includes(fact)).length;
            masteredFactsCountSpan.textContent = masteredCount;

            const progress = allFactsInTheme.length > 0 ? (masteredCount / allFactsInTheme.length) * 100 : 0;
            masteryProgressBar.style.width = `${progress}%`;
        }

        function markFactAsMastered(fact) {
            masteredFacts[fact] = true;
            localStorage.setItem('masteredFacts', JSON.stringify(masteredFacts));
            updateMasteryDisplay();
        }

        function generateQuiz() {
            quizFeedback.textContent = '';
            quizOptions.innerHTML = '';
            nextQuizBtn.style.display = 'none';

            const allFacts = Object.values(themes).map(t => t.fact);
            const correctFact = currentFact; // Quiz about the currently displayed fact
            currentQuizFact = correctFact;

            let options = [correctFact];
            while (options.length < 4) {
                const randomThemeKey = Object.keys(themes)[Math.floor(Math.random() * Object.keys(themes).length)];
                const randomFact = themes[randomThemeKey].fact;
                if (!options.includes(randomFact)) {
                    options.push(randomFact);
                }
            }
            options.sort(() => Math.random() - 0.5); // Shuffle options

            quizQuestion.textContent = `Which of these is the fact currently displayed: "${correctFact.substring(0, 50)}..."?`;

            options.forEach(option => {
                const button = document.createElement('button');
                button.classList.add('quiz-option-btn');
                button.textContent = option;
                button.dataset.fact = option;
                button.addEventListener('click', handleQuizAnswer);
                quizOptions.appendChild(button);
            });
        }

        function handleQuizAnswer(event) {
            const selectedButton = event.target;
            const selectedFact = selectedButton.dataset.fact;

            // Disable all buttons after selection
            document.querySelectorAll('.quiz-option-btn').forEach(btn => btn.disabled = true);

            if (selectedFact === currentQuizFact) {
                selectedButton.classList.add('correct');
                quizFeedback.textContent = 'Correct! Well done!';
                quizFeedback.style.color = 'var(--correct-answer-color)';
                incrementStreak();
                markFactAsMastered(currentQuizFact);
            } else {
                selectedButton.classList.add('incorrect');
                quizFeedback.textContent = 'Incorrect. Try again next time!';
                quizFeedback.style.color = 'var(--incorrect-answer-color)';
                // Highlight the correct answer
                document.querySelectorAll('.quiz-option-btn').forEach(btn => {
                    if (btn.dataset.fact === currentQuizFact) {
                        btn.classList.add('correct');
                    }
                });
                resetStreak();
            }
            nextQuizBtn.style.display = 'block';
        }

        function showQuiz() {
            factQuizContainer.classList.add('visible');
            quizMode = true;
            generateQuiz();
        }

        function hideQuiz() {
            factQuizContainer.classList.remove('visible');
            quizMode = false;
        }

        function generateChallenge() {
            challengeFeedback.textContent = '';
            challengeOptions.innerHTML = '';
            nextChallengeBtn.style.display = 'none';

            const allThemesKeys = Object.keys(themes);
            const correctThemeKey = allThemesKeys[Math.floor(Math.random() * allThemesKeys.length)];
            const correctTheme = themes[correctThemeKey];
            currentChallengeFact = correctTheme.fact;
            currentChallengeCorrectOption = correctTheme.title;

            let options = [correctTheme.title];
            while (options.length < 4) {
                const randomThemeKey = allThemesKeys[Math.floor(Math.random() * allThemesKeys.length)];
                const randomThemeTitle = themes[randomThemeKey].title;
                if (!options.includes(randomThemeTitle)) {
                    options.push(randomThemeTitle);
                }
            }
            options.sort(() => Math.random() - 0.5); // Shuffle options

            challengeQuestion.textContent = `Which theme does this fact belong to: "${currentChallengeFact}"?`;

            options.forEach(option => {
                const button = document.createElement('button');
                button.classList.add('challenge-option-btn');
                button.textContent = option;
                button.dataset.theme = option;
                button.addEventListener('click', handleChallengeAnswer);
                challengeOptions.appendChild(button);
            });
        }

        function handleChallengeAnswer(event) {
            const selectedButton = event.target;
            const selectedTheme = selectedButton.dataset.theme;

            // Disable all buttons after selection
            document.querySelectorAll('.challenge-option-btn').forEach(btn => btn.disabled = true);

            if (selectedTheme === currentChallengeCorrectOption) {
                selectedButton.classList.add('correct');
                challengeFeedback.textContent = 'Excellent! You nailed it!';
                challengeFeedback.style.color = 'var(--correct-answer-color)';
                incrementStreak();
                markFactAsMastered(currentChallengeFact);
            } else {
                selectedButton.classList.add('incorrect');
                challengeFeedback.textContent = `Oops! The correct theme was "${currentChallengeCorrectOption}".`;
                challengeFeedback.style.color = 'var(--incorrect-answer-color)';
                // Highlight the correct answer
                document.querySelectorAll('.challenge-option-btn').forEach(btn => {
                    if (btn.dataset.theme === currentChallengeCorrectOption) {
                        btn.classList.add('correct');
                    }
                });
                resetStreak();
            }
            nextChallengeBtn.style.display = 'block';
        }

        function showChallenge() {
            factChallengeContainer.classList.add('visible');
            challengeMode = true;
            generateChallenge();
        }

        function hideChallenge() {
            factChallengeContainer.classList.remove('visible');
            challengeMode = false;
        }

        // Event Listeners
        themeSelect.addEventListener('change', (e) => {
            currentTheme = e.target.value;
            applyTheme(currentTheme);
            showNewFact(); // Load a new fact for the selected theme
        });

        revealFactBtn.addEventListener('click', () => {
            mainFactContainer.classList.add('revealed');
            mainFactText.classList.add('animate-in');
            factRatingContainer.classList.add('visible');
        });

        newFactBtn.addEventListener('click', showNewFact);

        favoriteFactBtn.addEventListener('click', toggleFavoriteFact);

        toggleDidYouKnowBtn.addEventListener('click', () => {
            didYouKnowSection.classList.toggle('visible');
        });

        copyFactBtn.addEventListener('click', () => {
            navigator.clipboard.writeText(currentFact).then(() => {
                alert('Fact copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy fact: ', err);
            });
        });

        shareTwitterBtn.addEventListener('click', () => {
            const tweetText = encodeURIComponent(`"${currentFact}" #DeepSeaWonders #FactOfTheDay`);
            window.open(`https://twitter.com/intent/tweet?text=${tweetText}`, '_blank');
        });

        shareWhatsappBtn.addEventListener('click', () => {
            const whatsappText = encodeURIComponent(`Check out this amazing fact: "${currentFact}"`);
            window.open(`https://api.whatsapp.com/send?text=${whatsappText}`, '_blank');
        });

        toggleFavoritesBtn.addEventListener('click', () => {
            favoriteFactsDisplay.classList.toggle('visible');
            if (favoriteFactsDisplay.classList.contains('visible')) {
                renderFavoriteFacts();
            }
            factHistoryDisplay.classList.remove('visible'); // Hide history if favorites shown
            hideQuiz();
            hideChallenge();
        });

        toggleHistoryBtn.addEventListener('click', () => {
            factHistoryDisplay.classList.toggle('visible');
            if (factHistoryDisplay.classList.contains('visible')) {
                renderFactHistory();
            }
            favoriteFactsDisplay.classList.remove('visible'); // Hide favorites if history shown
            hideQuiz();
            hideChallenge();
        });

        stars.forEach(star => {
            star.addEventListener('click', (e) => {
                const rating = parseInt(e.target.dataset.value);
                setRating(rating);
            });
        });

        resetStreakBtn.addEventListener('click', resetStreak);

        toggleQuizBtn.addEventListener('click', () => {
            if (quizMode) {
                hideQuiz();
            } else {
                showQuiz();
                favoriteFactsDisplay.classList.remove('visible');
                factHistoryDisplay.classList.remove('visible');
                hideChallenge();
            }
        });

        nextQuizBtn.addEventListener('click', generateQuiz);

        toggleChallengeBtn.addEventListener('click', () => {
            if (challengeMode) {
                hideChallenge();
            } else {
                showChallenge();
                favoriteFactsDisplay.classList.remove('visible');
                factHistoryDisplay.classList.remove('visible');
                hideQuiz();
            }
        });

        nextChallengeBtn.addEventListener('click', generateChallenge);

        // Initial load
        document.addEventListener('DOMContentLoaded', () => {
            applyTheme(currentTheme);
            addFactToHistory(currentFact);
            updateFavoriteButtonState();
            updateFactStreakDisplay();
            updateMasteryDisplay();

            // Set initial update time for the footer
            const updateTimeElement = document.getElementById('update-time');
            const now = new Date();
            updateTimeElement.textContent = now.toLocaleString();
        });
    </script>
</body>
</html>