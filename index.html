<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="site-title">Cosmic Wonders</title>
    <style>
        :root {
            /* Cosmic Wonders Theme Colors */
            --bg-color-primary: #1A0033; /* Very Dark Purple */
            --bg-color-secondary: #330066; /* Darker Purple */
            --text-color: #E0E0FF; /* Light Lavender/White */
            --footer-bg: #0D001A; /* Even Darker Purple */
            --glass-bg: rgba(51, 0, 102, 0.7); /* Semi-transparent dark purple */
            --glass-border: rgba(224, 224, 255, 0.3); /* Light lavender border */
            --fact-text-shadow: 2px 2px 15px rgba(0,0,0,0.9);
            --title-color: #FFD700; /* Gold */
            --title-shadow: 4px 4px 25px rgba(0, 0, 0, 0.9);
            --main-action-btn: #8A2BE2; /* Blue Violet */
            --main-action-btn-hover: #6A1B9A; /* Darker Blue Violet */
            --theme-indicator-color: #FFD700; /* Gold */
            --favorite-btn-color: #FFD700; /* Gold */
            --favorite-btn-hover: #B8860B; /* Dark Goldenrod */
            --share-btn-color: #4CAF50; /* Green for share */
            --share-btn-hover: #388E3C; /* Darker Green */
            --rating-active-color: #8A2BE2; /* Blue Violet */
            --rating-text-color: #E0E0FF; /* Light Lavender */
            --category-select-bg: #330066; /* Darker Purple for select */
            --category-select-border: #8A2BE2; /* Blue Violet border */
            --quiz-correct-color: #4CAF50; /* Green */
            --quiz-incorrect-color: #F44336; /* Red */
        }

        body {
            background: linear-gradient(135deg, var(--bg-color-primary) 0%, var(--bg-color-secondary) 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            color: var(--text-color);\
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
            transition: background 1.5s ease-in-out, color 0.8s ease;
            overflow-x: hidden;
            position: relative;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            background: var(--glass-bg);
            border-radius: 20px;
            padding: 40px 60px;
            margin: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            max-width: 800px;
            width: 90%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 300px;
            transition: all 0.5s ease;
            animation: fadeInScale 0.8s ease-out forwards;
        }

        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        h1 {
            color: var(--title-color);
            font-size: 3.5rem;
            margin-bottom: 20px;
            text-shadow: var(--title-shadow);
            transition: color 0.5s ease;
        }

        #fact-display {
            font-size: 2.2rem;
            font-weight: 500;
            margin: 30px 0 15px 0;
            line-height: 1.4;
            text-shadow: var(--fact-text-shadow);
            color: var(--text-color);
            transition: color 0.5s ease, transform 0.5s ease, opacity 0.5s ease;
            opacity: 0;
            transform: translateY(20px);
        }

        #fact-display.revealed {
            opacity: 1;
            transform: translateY(0);
        }

        .action-button {
            background-color: var(--main-action-btn);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.3rem;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.4);
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            margin-top: 20px;
        }

        .action-button:hover {
            background-color: var(--main-action-btn-hover);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.5);
        }

        .action-button:disabled {
            background-color: #555;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .rating-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }

        .rating-buttons {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .rating-button {
            background-color: var(--glass-bg);
            border: 1px solid var(--glass-border);
            color: var(--text-color);
            padding: 10px 15px;
            font-size: 1.5rem;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            transition: all 0.2s ease;
        }

        .rating-button:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        }

        .rating-button.active {
            background-color: var(--rating-active-color);
            color: white;
            border-color: var(--rating-active-color);
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }

        #popularity-score {
            font-size: 1.1rem;
            color: var(--rating-text-color);
            margin-top: 10px;
            font-weight: bold;
        }

        .theme-indicator {
            position: absolute;
            top: 20px;
            left: 20px;
            background-color: var(--glass-bg);
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 0.9rem;
            color: var(--theme-indicator-color);
            border: 1px solid var(--glass-border);
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .favorite-button {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 2.5rem;
            cursor: pointer;
            color: var(--favorite-btn-color);
            transition: transform 0.2s ease, color 0.2s ease;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .favorite-button:hover {
            transform: scale(1.1);
            color: var(--favorite-btn-hover);
        }

        .favorite-button.favorited {
            color: var(--favorite-btn-hover);
            text-shadow: 0 0 15px var(--favorite-btn-color);
            transform: scale(1.1);
        }

        .utility-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .utility-buttons .action-button {
            margin-top: 0;
            background-color: var(--share-btn-color);
        }

        .utility-buttons .action-button:hover {
            background-color: var(--share-btn-hover);
        }

        footer {
            margin-top: 40px;
            padding: 15px 30px;
            background-color: var(--footer-bg);
            color: var(--text-color);
            width: 100%;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.3);
            font-size: 0.9rem;
            transition: background-color 0.8s ease, color 0.8s ease;
        }

        /* Category Selector */
        .category-selector {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .category-selector label {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--text-color);
        }

        .category-selector select {
            background-color: var(--category-select-bg);
            color: var(--text-color);
            border: 1px solid var(--category-select-border);
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            appearance: none; /* Remove default dropdown arrow */
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23E0E0FF%22%20d%3D%22M287%2C197.9L159.3%2C69.2c-3.7-3.7-9.7-3.7-13.4%2C0L5.4%2C197.9c-3.7%2C3.7-3.7%2C9.7%2C0%2C13.4l13.4%2C13.4c3.9%2C3.9%2C10.1%2C3.9%2C14%2C0l110.7-110.7l110.7%2C110.7c3.9%2C3.9%2C10.1%2C3.9%2C14%2C0l13.4-13.4C290.7%2C207.6%2C290.7%2C201.6%2C287%2C197.9z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 10px top 50%;
            background-size: 12px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .category-selector select:focus {
            outline: none;
            border-color: var(--main-action-btn-hover);
            box-shadow: 0 0 0 3px rgba(138, 43, 226, 0.3);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
            padding-top: 60px;
        }

        .modal-content {
            background-color: var(--glass-bg);
            margin: 5% auto;
            padding: 30px;
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            width: 80%;
            max-width: 700px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            position: relative;
            color: var(--text-color);
        }

        .modal-content h2 {
            color: var(--title-color);
            font-size: 2.5rem;
            margin-bottom: 20px;
            text-shadow: var(--title-shadow);
        }

        .modal-content ul {
            list-style: none;
            padding: 0;
            max-height: 400px;
            overflow-y: auto;
            border-top: 1px solid var(--glass-border);
            padding-top: 15px;
        }

        .modal-content li {
            background-color: rgba(255,255,255,0.05);
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 10px;
            text-align: left;
            font-size: 1.1rem;
            border: 1px solid rgba(255,255,255,0.1);
            transition: background-color 0.3s ease;
        }

        .modal-content li:hover {
            background-color: rgba(255,255,255,0.1);
        }

        .close-button {
            color: var(--text-color);
            position: absolute;
            top: 15px;
            right: 25px;
            font-size: 35px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close-button:hover,
        .close-button:focus {
            color: var(--title-color);
            text-decoration: none;
            cursor: pointer;
        }

        /* Quiz Specific Styles */
        .quiz-options button {
            display: block;
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            background-color: var(--glass-bg);
            color: var(--text-color);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .quiz-options button:hover {
            background-color: rgba(255,255,255,0.1);
            border-color: var(--main-action-btn);
        }

        .quiz-options button.correct {
            background-color: var(--quiz-correct-color);
            border-color: var(--quiz-correct-color);
            color: white;
        }

        .quiz-options button.incorrect {
            background-color: var(--quiz-incorrect-color);
            border-color: var(--quiz-incorrect-color);
            color: white;
        }

        #quiz-feedback {
            margin-top: 15px;
            font-size: 1.2rem;
            font-weight: bold;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }
            #fact-display {
                font-size: 1.5rem;
            }
            .container {
                padding: 30px;
            }
            .action-button {
                padding: 12px 25px;
                font-size: 1.1rem;
            }
            .utility-buttons {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="theme-indicator">Theme: <span id="current-theme">Cosmic Wonders</span></div>
        <h1 id="site-title">Cosmic Wonders</h1>

        <div class="category-selector">
            <label for="fact-category">Category:</label>
            <select id="fact-category">
                <option value="deep-sea">Deep Sea</option>
                <option value="space" selected>Space</option>
                <option value="history">History</option>
                <option value="science">Science</option>
            </select>
        </div>

        <p id="fact-display" class="revealed">There are more stars in the universe than grains of sand on all the beaches on Earth.</p>
        <div class="rating-section">
            <div id="popularity-score">Rating: 0</div>
            <div class="rating-buttons">
                <button class="rating-button" id="thumbs-up-btn" title="Like this fact">👍</button>
                <button class="rating-button" id="thumbs-down-btn" title="Dislike this fact">👎</button>
            </div>
        </div>
        <button class="action-button" id="next-fact-btn">Next Fact</button>
        <button class="favorite-button" id="favorite-btn" title="Add to favorites">⭐</button>

        <div class="utility-buttons">
            <button class="action-button" id="share-fact-btn">Share Fact</button>
            <button class="action-button" id="view-history-btn">View History</button>
            <button class="action-button" id="view-favorites-btn">View Favorites</button>
            <button class="action-button" id="fact-of-the-day-btn">Fact of the Day</button>
            <button class="action-button" id="quiz-me-btn">Quiz Me!</button>
        </div>
    </div>

    <div id="history-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="close-history-modal">&times;</span>
            <h2>Fact History</h2>
            <ul id="history-list">
                <!-- History items will be loaded here -->
            </ul>
        </div>
    </div>

    <div id="favorites-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="close-favorites-modal">&times;</span>
            <h2>Favorite Facts</h2>
            <ul id="favorites-list">
                <!-- Favorite items will be loaded here -->
            </ul>
        </div>
    </div>

    <div id="quiz-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="close-quiz-modal">&times;</span>
            <h2>Fact Quiz</h2>
            <p id="quiz-question"></p>
            <div class="quiz-options" id="quiz-options">
                <!-- Quiz options will be loaded here -->
            </div>
            <p id="quiz-feedback"></p>
            <button class="action-button" id="next-quiz-btn" style="display: none; margin-top: 20px;">Next Question</button>
        </div>
    </div>

    <footer>
        <p>Site will update automatically. Last update: <span id="last-update-time"></span></p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const factDisplay = document.getElementById('fact-display');
            const nextFactBtn = document.getElementById('next-fact-btn');
            const thumbsUpBtn = document.getElementById('thumbs-up-btn');
            const thumbsDownBtn = document.getElementById('thumbs-down-btn');
            const popularityScore = document.getElementById('popularity-score');
            const favoriteBtn = document.getElementById('favorite-btn');
            const shareFactBtn = document.getElementById('share-fact-btn');
            const viewHistoryBtn = document.getElementById('view-history-btn');
            const viewFavoritesBtn = document.getElementById('view-favorites-btn');
            const factOfTheDayBtn = document.getElementById('fact-of-the-day-btn');
            const quizMeBtn = document.getElementById('quiz-me-btn');

            const historyModal = document.getElementById('history-modal');
            const favoritesModal = document.getElementById('favorites-modal');
            const quizModal = document.getElementById('quiz-modal');

            const closeHistoryModal = document.getElementById('close-history-modal');
            const closeFavoritesModal = document.getElementById('close-favorites-modal');
            const closeQuizModal = document.getElementById('close-quiz-modal');

            const historyList = document.getElementById('history-list');
            const favoritesList = document.getElementById('favorites-list');
            const quizQuestion = document.getElementById('quiz-question');
            const quizOptions = document.getElementById('quiz-options');
            const quizFeedback = document.getElementById('quiz-feedback');
            const nextQuizBtn = document.getElementById('next-quiz-btn');

            const lastUpdateTime = document.getElementById('last-update-time');
            const factCategorySelect = document.getElementById('fact-category');
            const siteTitle = document.getElementById('site-title');
            const currentThemeIndicator = document.getElementById('current-theme');

            let currentFact = {
                text: "There are more stars in the universe than grains of sand on all the beaches on Earth.",
                category: "space",
                rating: 0
            };
            let factHistory = [];
            let favoriteFacts = [];

            const themes = {
                "deep-sea": {
                    title: "Mysteries of the Deep Sea",
                    primaryBg: "#0A1931",
                    secondaryBg: "#152A46",
                    textColor: "#E0F2F7",
                    footerBg: "#050F1A",
                    glassBg: "rgba(10, 25, 49, 0.7)",
                    glassBorder: "rgba(224, 242, 247, 0.3)",
                    titleColor: "#00BCD4",
                    mainActionBtn: "#00BCD4",
                    mainActionBtnHover: "#00838F",
                    themeIndicatorColor: "#00BCD4",
                    favoriteBtnColor: "#FFD700",
                    favoriteBtnHover: "#B8860B",
                    shareBtnColor: "#20B2AA",
                    shareBtnHover: "#1A8B84",
                    ratingActiveColor: "#00BCD4",
                    ratingTextColor: "#E0F2F7",
                    categorySelectBg: "#152A46",
                    categorySelectBorder: "#00BCD4",
                },
                "space": {
                    title: "Cosmic Wonders",
                    primaryBg: "#1A0033",
                    secondaryBg: "#330066",
                    textColor: "#E0E0FF",
                    footerBg: "#0D001A",
                    glassBg: "rgba(51, 0, 102, 0.7)",
                    glassBorder: "rgba(224, 224, 255, 0.3)",
                    titleColor: "#FFD700",
                    mainActionBtn: "#8A2BE2",
                    mainActionBtnHover: "#6A1B9A",
                    themeIndicatorColor: "#FFD700",
                    favoriteBtnColor: "#FFD700",
                    favoriteBtnHover: "#B8860B",
                    shareBtnColor: "#4CAF50",
                    shareBtnHover: "#388E3C",
                    ratingActiveColor: "#8A2BE2",
                    ratingTextColor: "#E0E0FF",
                    categorySelectBg: "#330066",
                    categorySelectBorder: "#8A2BE2",
                },
                "history": {
                    title: "Echoes of the Past",
                    primaryBg: "#4A3728",
                    secondaryBg: "#6F543E",
                    textColor: "#F5E6D3",
                    footerBg: "#33261E",
                    glassBg: "rgba(74, 55, 40, 0.7)",
                    glassBorder: "rgba(245, 230, 211, 0.3)",
                    titleColor: "#D4AF37", /* Gold */
                    mainActionBtn: "#A0522D", /* Sienna */
                    mainActionBtnHover: "#8B4513", /* SaddleBrown */
                    themeIndicatorColor: "#D4AF37",
                    favoriteBtnColor: "#FFD700",
                    favoriteBtnHover: "#B8860B",
                    shareBtnColor: "#6B8E23", /* OliveDrab */
                    shareBtnHover: "#556B2F", /* DarkOliveGreen */
                    ratingActiveColor: "#A0522D",
                    ratingTextColor: "#F5E6D3",
                    categorySelectBg: "#6F543E",
                    categorySelectBorder: "#A0522D",
                },
                "science": {
                    title: "Scientific Wonders",
                    primaryBg: "#2C3E50",
                    secondaryBg: "#34495E",
                    textColor: "#ECF0F1",
                    footerBg: "#212F3D",
                    glassBg: "rgba(44, 62, 80, 0.7)",
                    glassBorder: "rgba(236, 240, 241, 0.3)",
                    titleColor: "#2ECC71", /* Emerald Green */
                    mainActionBtn: "#3498DB", /* Peter River */
                    mainActionBtnHover: "#2980B9", /* Belize Hole */
                    themeIndicatorColor: "#2ECC71",
                    favoriteBtnColor: "#FFD700",
                    favoriteBtnHover: "#B8860B",
                    shareBtnColor: "#9B59B6", /* Amethyst */
                    shareBtnHover: "#8E44AD", /* Wisteria */
                    ratingActiveColor: "#3498DB",
                    ratingTextColor: "#ECF0F1",
                    categorySelectBg: "#34495E",
                    categorySelectBorder: "#3498DB",
                }
            };

            const facts = {
                "deep-sea": [
                    "The Mariana Trench is deeper than Mount Everest is tall, reaching approximately 11,000 meters (36,000 feet) below the surface.",
                    "Over 80% of our oceans remain unmapped, unobserved, and unexplored.",
                    "The deepest living fish, the Mariana snailfish, can withstand pressures equivalent to 1,600 elephants standing on a Mini Cooper.",
                    "Hydrothermal vents on the ocean floor can reach temperatures of over 400°C (750°F) but don't boil due to immense pressure.",
                    "The 'twilight zone' (mesopelagic zone) of the ocean, between 200 and 1,000 meters deep, is home to the largest migration of animals on Earth, occurring daily."
                ],
                "space": [
                    "A day on Venus is longer than a year on Venus.",
                    "There are more stars in the universe than grains of sand on all the beaches on Earth.",
                    "The largest known asteroid, Ceres, is also classified as a dwarf planet.",
                    "If you could fly to the nearest star, Proxima Centauri, it would take you about 73,000 years with current spacecraft technology.",
                    "The footprints left on the Moon by Apollo astronauts will likely stay there for at least 100 million years."
                ],
                "history": [
                    "The shortest war in history was between Britain and Zanzibar on August 27, 1896. Zanzibar surrendered after 38 minutes.",
                    "Ancient Romans used to clean and whiten their teeth with a mixture of urine and goat's milk.",
                    "The Great Wall of China is not visible from space with the naked eye, contrary to popular belief.",
                    "The first recorded use of the word 'hello' was in 1827.",
                    "Cleopatra lived closer in time to the invention of the iPhone than to the building of the Great Pyramid of Giza."
                ],
                "science": [
                    "Honey never spoils. Archaeologists have found pots of honey in ancient Egyptian tombs that are over 3,000 years old and still edible.",
                    "A single cloud can weigh more than 1 million pounds.",
                    "The human brain generates about 20 watts of electrical power when awake, enough to light a dim lightbulb.",
                    "Sound travels about 4.3 times faster in water than in air.",
                    "If you unravel all the DNA in your body, it would stretch from the Earth to the Sun and back over 600 times."
                ]
            };

            const quizzes = {
                "deep-sea": [
                    {
                        question: "What is the deepest known part of the Earth's oceans?",
                        options: ["Puerto Rico Trench", "Java Trench", "Mariana Trench", "Kermadec Trench"],
                        answer: "Mariana Trench"
                    },
                    {
                        question: "What percentage of the ocean remains unmapped and unexplored?",
                        options: ["Less than 10%", "About 25%", "Around 50%", "Over 80%"],
                        answer: "Over 80%"
                    }
                ],
                "space": [
                    {
                        question: "Which planet has a day longer than its year?",
                        options: ["Mars", "Venus", "Jupiter", "Mercury"],
                        answer: "Venus"
                    },
                    {
                        question: "What is the largest known asteroid, also classified as a dwarf planet?",
                        options: ["Vesta", "Pallas", "Hygiea", "Ceres"],
                        answer: "Ceres"
                    }
                ],
                "history": [
                    {
                        question: "What was the shortest war in recorded history?",
                        options: ["The Six-Day War", "Anglo-Zanzibar War", "Falklands War", "Ten-Day War"],
                        answer: "Anglo-Zanzibar War"
                    },
                    {
                        question: "Cleopatra lived closer in time to which of these events?",
                        options: ["Building of the Great Pyramid", "Founding of Rome", "Invention of the iPhone", "Life of Julius Caesar"],
                        answer: "Invention of the iPhone"
                    }
                ],
                "science": [
                    {
                        question: "Which food item never spoils?",
                        options: ["Milk", "Bread", "Honey", "Cheese"],
                        answer: "Honey"
                    },
                    {
                        question: "How much electrical power does the human brain generate when awake?",
                        options: ["About 5 watts", "About 20 watts", "About 50 watts", "About 100 watts"],
                        answer: "About 20 watts"
                    }
                ]
            };

            // Function to update the last update time in the footer
            const updateLastUpdateTime = () => {
                const now = new Date();
                lastUpdateTime.textContent = now.toLocaleString();
            };

            // Initial update
            updateLastUpdateTime();
            // Update every minute (or as desired)
            setInterval(updateLastUpdateTime, 60000);

            const applyTheme = (themeName) => {
                const theme = themes[themeName];
                if (!theme) return;

                const root = document.documentElement;
                root.style.setProperty('--bg-color-primary', theme.primaryBg);
                root.style.setProperty('--bg-color-secondary', theme.secondaryBg);
                root.style.setProperty('--text-color', theme.textColor);
                root.style.setProperty('--footer-bg', theme.footerBg);
                root.style.setProperty('--glass-bg', theme.glassBg);
                root.style.setProperty('--glass-border', theme.glassBorder);
                root.style.setProperty('--title-color', theme.titleColor);
                root.style.setProperty('--main-action-btn', theme.mainActionBtn);
                root.style.setProperty('--main-action-btn-hover', theme.mainActionBtnHover);
                root.style.setProperty('--theme-indicator-color', theme.themeIndicatorColor);
                root.style.setProperty('--favorite-btn-color', theme.favoriteBtnColor);
                root.style.setProperty('--favorite-btn-hover', theme.favoriteBtnHover);
                root.style.setProperty('--share-btn-color', theme.shareBtnColor);
                root.style.setProperty('--share-btn-hover', theme.shareBtnHover);
                root.style.setProperty('--rating-active-color', theme.ratingActiveColor);
                root.style.setProperty('--rating-text-color', theme.ratingTextColor);
                root.style.setProperty('--category-select-bg', theme.categorySelectBg);
                root.style.setProperty('--category-select-border', theme.categorySelectBorder);

                siteTitle.textContent = theme.title;
                currentThemeIndicator.textContent = theme.title;
            };

            const getRandomFact = (category) => {
                const categoryFacts = facts[category];
                if (!categoryFacts || categoryFacts.length === 0) {
                    return "No facts available for this category.";
                }
                const randomIndex = Math.floor(Math.random() * categoryFacts.length);
                return categoryFacts[randomIndex];
            };

            const displayFact = (factText, category) => {
                factDisplay.classList.remove('revealed');
                setTimeout(() => {
                    factDisplay.textContent = factText;
                    currentFact = { text: factText, category: category, rating: 0 };
                    popularityScore.textContent = `Rating: ${currentFact.rating}`;
                    thumbsUpBtn.classList.remove('active');
                    thumbsDownBtn.classList.remove('active');
                    favoriteBtn.classList.remove('favorited');
                    factDisplay.classList.add('revealed');
                }, 500); // Delay to allow fade-out animation
            };

            const addFactToHistory = (fact) => {
                factHistory.unshift(fact); // Add to the beginning
                if (factHistory.length > 10) { // Keep history to a reasonable size
                    factHistory.pop();
                }
            };

            nextFactBtn.addEventListener('click', () => {
                addFactToHistory(currentFact);
                const selectedCategory = factCategorySelect.value;
                displayFact(getRandomFact(selectedCategory), selectedCategory);
            });

            thumbsUpBtn.addEventListener('click', () => {
                if (!thumbsUpBtn.classList.contains('active')) {
                    currentFact.rating++;
                    popularityScore.textContent = `Rating: ${currentFact.rating}`;
                    thumbsUpBtn.classList.add('active');
                    thumbsDownBtn.classList.remove('active');
                }
            });

            thumbsDownBtn.addEventListener('click', () => {
                if (!thumbsDownBtn.classList.contains('active')) {
                    currentFact.rating--;
                    popularityScore.textContent = `Rating: ${currentFact.rating}`;
                    thumbsDownBtn.classList.add('active');
                    thumbsUpBtn.classList.remove('active');
                }
            });

            favoriteBtn.addEventListener('click', () => {
                const index = favoriteFacts.findIndex(f => f.text === currentFact.text);
                if (index === -1) {
                    favoriteFacts.push(currentFact);
                    favoriteBtn.classList.add('favorited');
                } else {
                    favoriteFacts.splice(index, 1);
                    favoriteBtn.classList.remove('favorited');
                }
            });

            shareFactBtn.addEventListener('click', () => {
                if (navigator.share) {
                    navigator.share({
                        title: document.title,
                        text: currentFact.text,
                        url: window.location.href
                    }).catch((error) => console.error('Error sharing:', error));
                } else {
                    alert('Sharing not supported on this browser. You can manually copy the fact: ' + currentFact.text);
                }
            });

            const populateModal = (listElement, factsArray) => {
                listElement.innerHTML = '';
                if (factsArray.length === 0) {
                    listElement.innerHTML = '<li>No facts to display.</li>';
                    return;
                }
                factsArray.forEach(fact => {
                    const li = document.createElement('li');
                    li.textContent = fact.text;
                    listElement.appendChild(li);
                });
            };

            viewHistoryBtn.addEventListener('click', () => {
                populateModal(historyList, factHistory);
                historyModal.style.display = 'block';
            });

            viewFavoritesBtn.addEventListener('click', () => {
                populateModal(favoritesList, favoriteFacts);
                favoritesModal.style.display = 'block';
            });

            closeHistoryModal.addEventListener('click', () => {
                historyModal.style.display = 'none';
            });

            closeFavoritesModal.addEventListener('click', () => {
                favoritesModal.style.display = 'none';
            });

            closeQuizModal.addEventListener('click', () => {
                quizModal.style.display = 'none';
            });

            window.addEventListener('click', (event) => {
                if (event.target == historyModal) {
                    historyModal.style.display = 'none';
                }
                if (event.target == favoritesModal) {
                    favoritesModal.style.display = 'none';
                }
                if (event.target == quizModal) {
                    quizModal.style.display = 'none';
                }
            });

            factOfTheDayBtn.addEventListener('click', () => {
                addFactToHistory(currentFact);
                const selectedCategory = factCategorySelect.value;
                displayFact(getRandomFact(selectedCategory), selectedCategory);
                alert("Here's your Fact of the Day!");
            });

            factCategorySelect.addEventListener('change', (event) => {
                addFactToHistory(currentFact);
                const selectedCategory = event.target.value;
                applyTheme(selectedCategory); // Apply theme based on selected category
                displayFact(getRandomFact(selectedCategory), selectedCategory);
            });

            // Quiz Feature Logic
            let currentQuiz = null;

            const getRandomQuiz = (category) => {
                const categoryQuizzes = quizzes[category];
                if (!categoryQuizzes || categoryQuizzes.length === 0) {
                    return null;
                }
                const randomIndex = Math.floor(Math.random() * categoryQuizzes.length);
                return categoryQuizzes[randomIndex];
            };

            const startQuiz = () => {
                const selectedCategory = factCategorySelect.value;
                currentQuiz = getRandomQuiz(selectedCategory);

                if (!currentQuiz) {
                    alert("No quiz available for this category yet!");
                    return;
                }

                quizQuestion.textContent = currentQuiz.question;
                quizOptions.innerHTML = '';
                quizFeedback.textContent = '';
                nextQuizBtn.style.display = 'none';

                currentQuiz.options.forEach(option => {
                    const button = document.createElement('button');
                    button.textContent = option;
                    button.addEventListener('click', () => checkAnswer(button, option));
                    quizOptions.appendChild(button);
                });

                quizModal.style.display = 'block';
            };

            const checkAnswer = (selectedButton, selectedOption) => {
                Array.from(quizOptions.children).forEach(button => {
                    button.disabled = true; // Disable all buttons after selection
                    if (button.textContent === currentQuiz.answer) {
                        button.classList.add('correct');
                    } else if (button === selectedButton) {
                        button.classList.add('incorrect');
                    }
                });

                if (selectedOption === currentQuiz.answer) {
                    quizFeedback.textContent = "Correct! 🎉";
                    quizFeedback.style.color = 'var(--quiz-correct-color)';
                } else {
                    quizFeedback.textContent = `Incorrect. The answer was: ${currentQuiz.answer}`;
                    quizFeedback.style.color = 'var(--quiz-incorrect-color)';
                }
                nextQuizBtn.style.display = 'block';
            };

            quizMeBtn.addEventListener('click', startQuiz);
            nextQuizBtn.addEventListener('click', startQuiz); // Allow user to get another quiz question

            // Initial fact display and theme application on load
            applyTheme(currentFact.category);
            displayFact(currentFact.text, currentFact.category);
        });
    </script>
</body>
</html>